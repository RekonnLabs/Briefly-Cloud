{"version":3,"names":["GET","cov_djw75rth3","f","s","POST","_performance","withPerformanceMonitoring","req","session","_nextauth","getServerSession","_auth","authOptions","user","b","_server","NextResponse","json","error","status","isAdmin","email","process","env","ADMIN_EMAIL","metrics","PerformanceMonitor","getMetrics","cacheStats","_cache","cacheManager","getStats","performance","requests","avgResponseTime","errorRate","databaseQueries","avgDatabaseQueryTime","externalApiCalls","avgExternalApiTime","cache","size","max","hits","misses","hitRate","timestamp","Date","toISOString","uptime","memory","memoryUsage","action","reset","message","clear"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\performance\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { getServerSession } from 'next-auth'\r\nimport { authOptions } from '@/app/lib/auth'\r\nimport { PerformanceMonitor } from '@/app/lib/performance'\r\nimport { cacheManager } from '@/app/lib/cache'\r\nimport { withPerformanceMonitoring } from '@/app/lib/performance'\r\n\r\nexport const GET = withPerformanceMonitoring(async (req: NextRequest) => {\r\n  const session = await getServerSession(authOptions)\r\n  \r\n  // Only allow authenticated users to access performance metrics\r\n  if (!session?.user) {\r\n    return NextResponse.json(\r\n      { error: 'Unauthorized' },\r\n      { status: 401 }\r\n    )\r\n  }\r\n\r\n  // Check if user is admin (you can implement your own admin check)\r\n  const isAdmin = session.user.email === process.env.ADMIN_EMAIL\r\n  \r\n  if (!isAdmin) {\r\n    return NextResponse.json(\r\n      { error: 'Forbidden' },\r\n      { status: 403 }\r\n    )\r\n  }\r\n\r\n  const metrics = PerformanceMonitor.getMetrics()\r\n  const cacheStats = cacheManager.getStats()\r\n\r\n  return NextResponse.json({\r\n    performance: {\r\n      requests: metrics.requests,\r\n      avgResponseTime: metrics.avgResponseTime,\r\n      errorRate: metrics.errorRate,\r\n      databaseQueries: metrics.databaseQueries,\r\n      avgDatabaseQueryTime: metrics.avgDatabaseQueryTime,\r\n      externalApiCalls: metrics.externalApiCalls,\r\n      avgExternalApiTime: metrics.avgExternalApiTime,\r\n    },\r\n    cache: {\r\n      size: cacheStats.size,\r\n      max: cacheStats.max,\r\n      hits: cacheStats.hits,\r\n      misses: cacheStats.misses,\r\n      hitRate: cacheStats.hitRate,\r\n    },\r\n    timestamp: new Date().toISOString(),\r\n    uptime: process.uptime(),\r\n    memory: process.memoryUsage(),\r\n  })\r\n})\r\n\r\nexport const POST = withPerformanceMonitoring(async (req: NextRequest) => {\r\n  const session = await getServerSession(authOptions)\r\n  \r\n  if (!session?.user) {\r\n    return NextResponse.json(\r\n      { error: 'Unauthorized' },\r\n      { status: 401 }\r\n    )\r\n  }\r\n\r\n  const isAdmin = session.user.email === process.env.ADMIN_EMAIL\r\n  \r\n  if (!isAdmin) {\r\n    return NextResponse.json(\r\n      { error: 'Forbidden' },\r\n      { status: 403 }\r\n    )\r\n  }\r\n\r\n  const { action } = await req.json()\r\n\r\n  switch (action) {\r\n    case 'reset':\r\n      PerformanceMonitor.reset()\r\n      return NextResponse.json({ message: 'Performance metrics reset' })\r\n    \r\n    case 'clear-cache':\r\n      cacheManager.clear()\r\n      return NextResponse.json({ message: 'Cache cleared' })\r\n    \r\n    default:\r\n      return NextResponse.json(\r\n        { error: 'Invalid action' },\r\n        { status: 400 }\r\n      )\r\n  }\r\n})\r\n"],"mappings":"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","ignoreList":[]}