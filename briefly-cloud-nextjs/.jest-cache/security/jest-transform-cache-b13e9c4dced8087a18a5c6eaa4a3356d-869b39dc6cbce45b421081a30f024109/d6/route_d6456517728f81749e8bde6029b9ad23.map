{"version":3,"names":["cov_2lhxagpcoo","actualCoverage","s","GET","req","f","origin","nextUrl","redirectUri","tenant","b","process","env","AZURE_AD_TENANT_ID","state","crypto","randomUUID","_headers","cookies","set","httpOnly","sameSite","secure","NODE_ENV","path","maxAge","url","URL","searchParams","AZURE_AD_CLIENT_ID","_server","NextResponse","redirect","toString"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\storage\\microsoft\\start\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const origin = req.nextUrl.origin\r\n  const redirectUri = `${origin}/api/storage/microsoft/callback`\r\n  const tenant = process.env.AZURE_AD_TENANT_ID || 'common'\r\n  \r\n  // Generate CSRF state token\r\n  const state = crypto.randomUUID()\r\n  cookies().set('oauth_state_microsoft', state, { \r\n    httpOnly: true, \r\n    sameSite: 'lax', \r\n    secure: process.env.NODE_ENV === 'production',\r\n    path: '/',\r\n    maxAge: 600 // 10 minutes\r\n  })\r\n  \r\n  const url = new URL(`https://login.microsoftonline.com/${tenant}/oauth2/v2.0/authorize`)\r\n  url.searchParams.set('client_id', process.env.AZURE_AD_CLIENT_ID!)\r\n  url.searchParams.set('response_type', 'code')\r\n  url.searchParams.set('redirect_uri', redirectUri)\r\n  url.searchParams.set('response_mode', 'query')\r\n  url.searchParams.set('scope', 'openid email profile offline_access Files.Read.All')\r\n  url.searchParams.set('state', state)\r\n  \r\n  return NextResponse.redirect(url.toString())\r\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAMQ;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAAAA,cAAA,GAAAE,CAAA;;;;;;+BAHc;;;;;;WAAAC,GAAA;;;;;kCAHoB;;;kCAClB;AAEjB,eAAeA,IAAIC,GAAgB;EAAA;EAAAJ,cAAA,GAAAK,CAAA;EACxC,MAAMC,MAAA;EAAA;EAAA,CAAAN,cAAA,GAAAE,CAAA,OAASE,GAAA,CAAIG,OAAO,CAACD,MAAM;EACjC,MAAME,WAAA;EAAA;EAAA,CAAAR,cAAA,GAAAE,CAAA,OAAc,GAAGI,MAAA,iCAAuC;EAC9D,MAAMG,MAAA;EAAA;EAAA,CAAAT,cAAA,GAAAE,CAAA;EAAS;EAAA,CAAAF,cAAA,GAAAU,CAAA,UAAAC,OAAA,CAAQC,GAAG,CAACC,kBAAkB;EAAA;EAAA,CAAAb,cAAA,GAAAU,CAAA,UAAI;EAEjD;EACA,MAAMI,KAAA;EAAA;EAAA,CAAAd,cAAA,GAAAE,CAAA,OAAQa,MAAA,CAAOC,UAAU;EAAA;EAAAhB,cAAA,GAAAE,CAAA;EAC/B,IAAAe,QAAA,CAAAC,OAAO,IAAGC,GAAG,CAAC,yBAAyBL,KAAA,EAAO;IAC5CM,QAAA,EAAU;IACVC,QAAA,EAAU;IACVC,MAAA,EAAQX,OAAA,CAAQC,GAAG,CAACW,QAAQ,KAAK;IACjCC,IAAA,EAAM;IACNC,MAAA,EAAQ,IAAI;EACd;EAEA,MAAMC,GAAA;EAAA;EAAA,CAAA1B,cAAA,GAAAE,CAAA,QAAM,IAAIyB,GAAA,CAAI,qCAAqClB,MAAA,wBAA8B;EAAA;EAAAT,cAAA,GAAAE,CAAA;EACvFwB,GAAA,CAAIE,YAAY,CAACT,GAAG,CAAC,aAAaR,OAAA,CAAQC,GAAG,CAACiB,kBAAkB;EAAA;EAAA7B,cAAA,GAAAE,CAAA;EAChEwB,GAAA,CAAIE,YAAY,CAACT,GAAG,CAAC,iBAAiB;EAAA;EAAAnB,cAAA,GAAAE,CAAA;EACtCwB,GAAA,CAAIE,YAAY,CAACT,GAAG,CAAC,gBAAgBX,WAAA;EAAA;EAAAR,cAAA,GAAAE,CAAA;EACrCwB,GAAA,CAAIE,YAAY,CAACT,GAAG,CAAC,iBAAiB;EAAA;EAAAnB,cAAA,GAAAE,CAAA;EACtCwB,GAAA,CAAIE,YAAY,CAACT,GAAG,CAAC,SAAS;EAAA;EAAAnB,cAAA,GAAAE,CAAA;EAC9BwB,GAAA,CAAIE,YAAY,CAACT,GAAG,CAAC,SAASL,KAAA;EAAA;EAAAd,cAAA,GAAAE,CAAA;EAE9B,OAAO4B,OAAA,CAAAC,YAAY,CAACC,QAAQ,CAACN,GAAA,CAAIO,QAAQ;AAC3C","ignoreList":[]}