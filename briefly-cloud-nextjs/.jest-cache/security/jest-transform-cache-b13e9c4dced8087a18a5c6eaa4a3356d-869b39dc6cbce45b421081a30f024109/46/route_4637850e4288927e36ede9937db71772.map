{"version":3,"names":["cov_bk9k1xypl","path","hash","global","Function","gcv","coverageData","statementMap","start","line","column","end","fnMap","name","decl","loc","branchMap","type","locations","undefined","s","f","b","inputSourceMap","version","sources","sourcesContent","names","mappings","_coverageSchema","coverage","actualCoverage","GET","POST","request","authHeader","headers","get","expectedAuth","process","env","CRON_SECRET","_logger","logger","warn","ip","user_agent","_apiutils","createErrorResponse","info","_gdprcompliance","gdprService","cleanupExpiredData","cleanupResults","expired_data_cleaned","timestamp","Date","toISOString","createApiResponse","message","results","error","Error","stack","status","last_run","next_run"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\cron\\gdpr-cleanup\\route.ts"],"sourcesContent":["/**\r\n * GDPR Data Cleanup Cron Job\r\n * \r\n * Scheduled job for cleaning up expired data and maintaining GDPR compliance\r\n * This should be called by Vercel Cron or similar scheduling service\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { gdprService } from '@/app/lib/gdpr-compliance';\r\nimport { createApiResponse, createErrorResponse } from '@/app/lib/api-utils';\r\nimport { logger } from '@/app/lib/logger';\r\n\r\n/**\r\n * POST /api/cron/gdpr-cleanup\r\n * Run GDPR compliance cleanup tasks\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    // Verify this is a legitimate cron request\r\n    const authHeader = request.headers.get('authorization');\r\n    const expectedAuth = `Bearer ${process.env.CRON_SECRET}`;\r\n    \r\n    if (!process.env.CRON_SECRET || authHeader !== expectedAuth) {\r\n      logger.warn('Unauthorized cron job attempt', {\r\n        ip: request.headers.get('x-forwarded-for'),\r\n        user_agent: request.headers.get('user-agent')\r\n      });\r\n      return createErrorResponse('Unauthorized', 401);\r\n    }\r\n\r\n    logger.info('Starting GDPR cleanup job');\r\n\r\n    // Run cleanup tasks\r\n    await gdprService.cleanupExpiredData();\r\n\r\n    // Additional cleanup tasks can be added here\r\n    const cleanupResults = {\r\n      expired_data_cleaned: true,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    logger.info('GDPR cleanup job completed successfully', cleanupResults);\r\n\r\n    return createApiResponse({\r\n      message: 'GDPR cleanup completed successfully',\r\n      results: cleanupResults\r\n    });\r\n\r\n  } catch (error) {\r\n    logger.error('GDPR cleanup job failed', {\r\n      error: error instanceof Error ? error.message : 'Unknown error',\r\n      stack: error instanceof Error ? error.stack : undefined\r\n    });\r\n\r\n    return createErrorResponse('Cleanup job failed', 500, {\r\n      error: error instanceof Error ? error.message : 'Unknown error'\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/cron/gdpr-cleanup\r\n * Get status of last cleanup job (for monitoring)\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // This could return status information about the last cleanup\r\n    // For now, just return a simple status\r\n    return createApiResponse({\r\n      status: 'ready',\r\n      last_run: 'Check logs for last execution time',\r\n      next_run: 'Scheduled via Vercel Cron'\r\n    });\r\n\r\n  } catch (error) {\r\n    return createErrorResponse('Failed to get cleanup status', 500);\r\n  }\r\n}"],"mappings":"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","ignoreList":[]}