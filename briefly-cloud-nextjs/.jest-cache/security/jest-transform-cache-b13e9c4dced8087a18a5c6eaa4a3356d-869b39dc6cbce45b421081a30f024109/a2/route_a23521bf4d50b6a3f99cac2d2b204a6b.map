{"version":3,"names":["PATCH","cov_11mjzx8zg2","f","s","POST","PUT","SendNotificationSchema","_zod","z","object","type","enum","title","string","min","max","message","action_url","url","optional","action_text","user_ids","array","uuid","priority","default","SendMigrationAnnouncementSchema","use_template","boolean","SendMaintenanceAlertSchema","scheduled_time","datetime","duration","request","withRateLimit","session","getServerSession","authOptions","user","b","_apierrors","formatErrorResponse","data","fetch","process","env","NEXTAUTH_URL","headers","Authorization","accessToken","then","res","json","is_admin","body","parse","notificationManager","_notifications","NotificationManager","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","length","notifications","map","userId","user_id","status","notification","createNotification","_logger","logger","info","adminId","id","userCount","sendMigrationAnnouncement","sendMaintenanceAlert","users","error","usersError","Error","_server","NextResponse","success","user_count","finalTitle","finalMessage","finalActionUrl","finalActionText","template","MIGRATION_TEMPLATES","announcement","useTemplate","scheduledTime"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\admin\\notifications\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { withAuth } from '@/app/lib/auth/auth-middleware'\r\nimport { NotificationManager, MIGRATION_TEMPLATES } from '@/app/lib/notifications'\r\nimport { logger } from '@/app/lib/logger'\r\nimport { formatErrorResponse } from '@/app/lib/api-errors'\r\nimport { z } from 'zod'\r\n\r\n// Admin notification request schemas\r\nconst SendNotificationSchema = z.object({\r\n  type: z.enum(['migration_announcement', 'migration_progress', 'migration_complete', 'migration_issue', 'maintenance_alert', 'feature_update', 'security_alert']),\r\n  title: z.string().min(1).max(200),\r\n  message: z.string().min(1).max(1000),\r\n  action_url: z.string().url().optional(),\r\n  action_text: z.string().max(50).optional(),\r\n  user_ids: z.array(z.string().uuid()).optional(), // If not provided, sends to all active users\r\n  priority: z.enum(['low', 'medium', 'high', 'critical']).optional().default('medium'),\r\n})\r\n\r\nconst SendMigrationAnnouncementSchema = z.object({\r\n  title: z.string().min(1).max(200).optional(),\r\n  message: z.string().min(1).max(1000).optional(),\r\n  action_url: z.string().url().optional(),\r\n  action_text: z.string().max(50).optional(),\r\n  use_template: z.boolean().optional().default(true),\r\n})\r\n\r\nconst SendMaintenanceAlertSchema = z.object({\r\n  title: z.string().min(1).max(200),\r\n  message: z.string().min(1).max(1000),\r\n  scheduled_time: z.string().datetime().optional(),\r\n  duration: z.string().optional(),\r\n})\r\n\r\nexport async function POST(request: NextRequest) {\r\n  return withRateLimit(request, async () => {\r\n    try {\r\n      const session = await getServerSession(authOptions)\r\n      if (!session?.user) {\r\n        return formatErrorResponse('Unauthorized', 401)\r\n      }\r\n\r\n      // Check admin privileges\r\n      const { data: user } = await fetch(`${process.env.NEXTAUTH_URL}/api/user/profile`, {\r\n        headers: { Authorization: `Bearer ${session.accessToken}` }\r\n      }).then(res => res.json())\r\n\r\n      if (!user?.is_admin) {\r\n        return formatErrorResponse('Admin privileges required', 403)\r\n      }\r\n\r\n      const body = await request.json()\r\n      const { type, title, message, action_url, action_text, user_ids, priority } = SendNotificationSchema.parse(body)\r\n\r\n      const notificationManager = new NotificationManager(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n      )\r\n\r\n      if (user_ids && user_ids.length > 0) {\r\n        // Send to specific users\r\n        const notifications = user_ids.map(userId => ({\r\n          user_id: userId,\r\n          type,\r\n          priority,\r\n          title,\r\n          message,\r\n          action_url,\r\n          action_text,\r\n          status: 'pending' as const,\r\n        }))\r\n\r\n        for (const notification of notifications) {\r\n          await notificationManager.createNotification(notification)\r\n        }\r\n\r\n        logger.info('Admin notification sent to specific users', { \r\n          adminId: session.user.id,\r\n          type,\r\n          userCount: user_ids.length,\r\n          title \r\n        })\r\n      } else {\r\n        // Send to all active users\r\n        if (type === 'migration_announcement') {\r\n          await notificationManager.sendMigrationAnnouncement(title, message, action_url, action_text)\r\n        } else if (type === 'maintenance_alert') {\r\n          await notificationManager.sendMaintenanceAlert(title, message)\r\n        } else {\r\n          // For other types, we need to get all active users and send individually\r\n          const { data: users, error: usersError } = await fetch(`${process.env.NEXTAUTH_URL}/api/admin/users/active`, {\r\n            headers: { Authorization: `Bearer ${session.accessToken}` }\r\n          }).then(res => res.json())\r\n\r\n          if (usersError) throw new Error(usersError)\r\n\r\n          const notifications = users.data.map((user: any) => ({\r\n            user_id: user.id,\r\n            type,\r\n            priority,\r\n            title,\r\n            message,\r\n            action_url,\r\n            action_text,\r\n            status: 'pending' as const,\r\n          }))\r\n\r\n          for (const notification of notifications) {\r\n            await notificationManager.createNotification(notification)\r\n          }\r\n\r\n          logger.info('Admin notification sent to all users', { \r\n            adminId: session.user.id,\r\n            type,\r\n            userCount: users.data.length,\r\n            title \r\n          })\r\n        }\r\n      }\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: 'Notification sent successfully',\r\n        data: {\r\n          type,\r\n          title,\r\n          user_count: user_ids?.length || 'all_active_users'\r\n        }\r\n      })\r\n\r\n    } catch (error) {\r\n      logger.error('Failed to send admin notification', { error })\r\n      return formatErrorResponse('Failed to send notification', 500)\r\n    }\r\n  })\r\n}\r\n\r\n// Special endpoint for migration announcements\r\nexport async function PUT(request: NextRequest) {\r\n  return withRateLimit(request, async () => {\r\n    try {\r\n      const session = await getServerSession(authOptions)\r\n      if (!session?.user) {\r\n        return formatErrorResponse('Unauthorized', 401)\r\n      }\r\n\r\n      // Check admin privileges\r\n      const { data: user } = await fetch(`${process.env.NEXTAUTH_URL}/api/user/profile`, {\r\n        headers: { Authorization: `Bearer ${session.accessToken}` }\r\n      }).then(res => res.json())\r\n\r\n      if (!user?.is_admin) {\r\n        return formatErrorResponse('Admin privileges required', 403)\r\n      }\r\n\r\n      const body = await request.json()\r\n      const { title, message, action_url, action_text, use_template } = SendMigrationAnnouncementSchema.parse(body)\r\n\r\n      const notificationManager = new NotificationManager(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n      )\r\n\r\n      let finalTitle = title\r\n      let finalMessage = message\r\n      let finalActionUrl = action_url\r\n      let finalActionText = action_text\r\n\r\n      if (use_template) {\r\n        const template = MIGRATION_TEMPLATES.announcement\r\n        finalTitle = title || template.title\r\n        finalMessage = message || template.message\r\n        finalActionUrl = action_url || '/briefly/app/migration-info'\r\n        finalActionText = action_text || template.action_text\r\n      }\r\n\r\n      await notificationManager.sendMigrationAnnouncement(\r\n        finalTitle,\r\n        finalMessage,\r\n        finalActionUrl,\r\n        finalActionText\r\n      )\r\n\r\n      logger.info('Migration announcement sent', { \r\n        adminId: session.user.id,\r\n        title: finalTitle,\r\n        useTemplate: use_template\r\n      })\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: 'Migration announcement sent successfully',\r\n        data: {\r\n          title: finalTitle,\r\n          message: finalMessage,\r\n          action_url: finalActionUrl,\r\n          action_text: finalActionText,\r\n        }\r\n      })\r\n\r\n    } catch (error) {\r\n      logger.error('Failed to send migration announcement', { error })\r\n      return formatErrorResponse('Failed to send migration announcement', 500)\r\n    }\r\n  })\r\n}\r\n\r\n// Maintenance alert endpoint\r\nexport async function PATCH(request: NextRequest) {\r\n  return withRateLimit(request, async () => {\r\n    try {\r\n      const session = await getServerSession(authOptions)\r\n      if (!session?.user) {\r\n        return formatErrorResponse('Unauthorized', 401)\r\n      }\r\n\r\n      // Check admin privileges\r\n      const { data: user } = await fetch(`${process.env.NEXTAUTH_URL}/api/user/profile`, {\r\n        headers: { Authorization: `Bearer ${session.accessToken}` }\r\n      }).then(res => res.json())\r\n\r\n      if (!user?.is_admin) {\r\n        return formatErrorResponse('Admin privileges required', 403)\r\n      }\r\n\r\n      const body = await request.json()\r\n      const { title, message, scheduled_time, duration } = SendMaintenanceAlertSchema.parse(body)\r\n\r\n      const notificationManager = new NotificationManager(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n      )\r\n\r\n      await notificationManager.sendMaintenanceAlert(title, message, scheduled_time, duration)\r\n\r\n      logger.info('Maintenance alert sent', { \r\n        adminId: session.user.id,\r\n        title,\r\n        scheduledTime: scheduled_time,\r\n        duration\r\n      })\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: 'Maintenance alert sent successfully',\r\n        data: {\r\n          title,\r\n          message,\r\n          scheduled_time,\r\n          duration,\r\n        }\r\n      })\r\n\r\n    } catch (error) {\r\n      logger.error('Failed to send maintenance alert', { error })\r\n      return formatErrorResponse('Failed to send maintenance alert', 500)\r\n    }\r\n  })\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}