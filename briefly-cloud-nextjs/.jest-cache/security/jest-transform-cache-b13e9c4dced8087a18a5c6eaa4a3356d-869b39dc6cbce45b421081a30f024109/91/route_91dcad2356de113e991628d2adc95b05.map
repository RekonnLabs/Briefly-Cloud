{"version":3,"names":["POST","batchEmbeddingRequestSchema","cov_ymvapbnud","s","_zod","z","object","texts","array","string","min","max","model","enum","optional","dimensions","number","include_metadata","boolean","default","include_similarities","generateBatchEmbeddingsHandler","request","context","f","user","b","_apiutils","ApiResponse","unauthorized","body","json","validation","safeParse","success","badRequest","_embeddings","DEFAULT_EMBEDDING_MODEL","data","embeddingsService","isUserKey","subscription_tier","createClient","Promise","resolve","then","_interop_require_wildcard","require","supabase","_supabase","supabaseAdmin","apiKeyData","from","select","eq","id","single","value","createUserEmbeddingsService","createEmbeddingsService","result","generateBatchEmbeddings","similarities","length","calculateSimilarity","i","embeddings","row","j","push","similarity","embedding","responseData","map","emb","index","tokens","text_preview","substring","metadata","total_texts","total_tokens","totalTokens","total_cost","totalCost","processing_time","processingTime","average_tokens_per_text","Math","round","model_info","getEmbeddingModelInfo","is_user_key","texts_info","count","total_length","reduce","sum","text","average_length","length_distribution","t","median","sort","a","floor","matrix","description","interpretation","_logger","logApiUsage","text_count","error","console","Error","name","internalError","_apimiddleware","createProtectedApiHandler","rateLimit","_ratelimit","rateLimitConfigs","maxRequests","logging","enabled","includeBody"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\embeddings\\batch\\route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createProtectedApiHandler, ApiContext } from '@/app/lib/api-middleware'\r\nimport { ApiResponse } from '@/app/lib/api-utils'\r\nimport { rateLimitConfigs } from '@/app/lib/rate-limit'\r\nimport { logApiUsage } from '@/app/lib/logger'\r\nimport { \r\n  EmbeddingsService,\r\n  createEmbeddingsService,\r\n  createUserEmbeddingsService,\r\n  DEFAULT_EMBEDDING_MODEL,\r\n  getEmbeddingModelInfo\r\n} from '@/app/lib/embeddings'\r\nimport { z } from 'zod'\r\nimport { supabaseAdmin } from '@/app/lib/supabase'\n\r\n// Validation schema\r\nconst batchEmbeddingRequestSchema = z.object({\r\n  texts: z.array(z.string().min(1)).min(1).max(100), // Max 100 texts at once\r\n  model: z.enum(['text-embedding-3-small', 'text-embedding-3-large', 'text-embedding-ada-002']).optional(),\r\n  dimensions: z.number().min(256).max(3072).optional(),\r\n  include_metadata: z.boolean().optional().default(true),\r\n  include_similarities: z.boolean().optional().default(false),\r\n})\r\n\r\n// POST /api/embeddings/batch - Generate embeddings for multiple texts\r\nasync function generateBatchEmbeddingsHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const body = await request.json()\r\n    const validation = batchEmbeddingRequestSchema.safeParse(body)\r\n    \r\n    if (!validation.success) {\r\n      return ApiResponse.badRequest('Invalid request data')\r\n    }\r\n    \r\n    const { \r\n      texts, \r\n      model = DEFAULT_EMBEDDING_MODEL, \r\n      dimensions,\r\n      include_metadata,\r\n      include_similarities\r\n    } = validation.data\r\n    \r\n    // Check if user has BYOK tier and their own API key\r\n    let embeddingsService: EmbeddingsService\r\n    let isUserKey = false\r\n    \r\n    if (user.subscription_tier === 'pro_byok') {\r\n      const { createClient } = await import('@supabase/supabase-js')\r\n      const supabase = supabaseAdmin\r\n      \r\n      const { data: apiKeyData } = await supabase\r\n        .from('user_settings')\r\n        .select('value')\r\n        .eq('user_id', user.id)\r\n        .eq('key', 'openai_api_key')\r\n        .single()\r\n      \r\n      if (apiKeyData?.value) {\r\n        embeddingsService = createUserEmbeddingsService(apiKeyData.value, { dimensions })\r\n        isUserKey = true\r\n      } else {\r\n        embeddingsService = createEmbeddingsService({ dimensions })\r\n      }\r\n    } else {\r\n      embeddingsService = createEmbeddingsService({ dimensions })\r\n    }\r\n    \r\n    // Generate batch embeddings\r\n    const result = await embeddingsService.generateBatchEmbeddings(texts, model)\r\n    \r\n    // Calculate similarities if requested\r\n    let similarities: number[][] | undefined\r\n    if (include_similarities && texts.length > 1) {\r\n      similarities = []\r\n      const { calculateSimilarity } = await import('@/app/lib/embeddings')\r\n      \r\n      for (let i = 0; i < result.embeddings.length; i++) {\r\n        const row: number[] = []\r\n        for (let j = 0; j < result.embeddings.length; j++) {\r\n          if (i === j) {\r\n            row.push(1.0) // Self-similarity is 1.0\r\n          } else {\r\n            const similarity = calculateSimilarity(\r\n              result.embeddings[i].embedding,\r\n              result.embeddings[j].embedding\r\n            )\r\n            row.push(similarity)\r\n          }\r\n        }\r\n        similarities.push(row)\r\n      }\r\n    }\r\n    \r\n    // Prepare response data\r\n    const responseData: any = {\r\n      embeddings: result.embeddings.map((emb, index) => ({\r\n        index,\r\n        embedding: emb.embedding,\r\n        dimensions: emb.dimensions,\r\n        tokens: emb.tokens,\r\n        text_preview: texts[index].substring(0, 100) + (texts[index].length > 100 ? '...' : ''),\r\n      })),\r\n    }\r\n    \r\n    if (include_metadata) {\r\n      responseData.metadata = {\r\n        model: result.model,\r\n        total_texts: texts.length,\r\n        total_tokens: result.totalTokens,\r\n        total_cost: result.totalCost,\r\n        processing_time: result.processingTime,\r\n        average_tokens_per_text: Math.round(result.totalTokens / texts.length),\r\n        model_info: getEmbeddingModelInfo(model),\r\n        is_user_key: isUserKey,\r\n      }\r\n      \r\n      responseData.texts_info = {\r\n        count: texts.length,\r\n        total_length: texts.reduce((sum, text) => sum + text.length, 0),\r\n        average_length: Math.round(texts.reduce((sum, text) => sum + text.length, 0) / texts.length),\r\n        length_distribution: {\r\n          min: Math.min(...texts.map(t => t.length)),\r\n          max: Math.max(...texts.map(t => t.length)),\r\n          median: texts.map(t => t.length).sort((a, b) => a - b)[Math.floor(texts.length / 2)],\r\n        },\r\n      }\r\n    }\r\n    \r\n    if (include_similarities && similarities) {\r\n      responseData.similarities = {\r\n        matrix: similarities,\r\n        description: 'Cosine similarity matrix between all text pairs',\r\n        interpretation: 'Values range from -1 to 1, where 1 means identical, 0 means orthogonal, -1 means opposite',\r\n      }\r\n    }\r\n    \r\n    // Log usage\r\n    logApiUsage(user.id, '/api/embeddings/batch', 'batch_embedding_generation', {\r\n      model,\r\n      text_count: texts.length,\r\n      total_tokens: result.totalTokens,\r\n      total_cost: result.totalCost,\r\n      processing_time: result.processingTime,\r\n      include_similarities,\r\n      is_user_key: isUserKey,\r\n    })\r\n    \r\n    return ApiResponse.success(responseData, 'Batch embeddings generated successfully')\r\n    \r\n  } catch (error) {\r\n    console.error('Generate batch embeddings handler error:', error)\r\n    \r\n    if (error instanceof Error && error.name === 'AppError') {\r\n      throw error\r\n    }\r\n    \r\n    return ApiResponse.internalError('Failed to generate batch embeddings')\r\n  }\r\n}\r\n\r\n// Export handler with middleware\r\nexport const POST = createProtectedApiHandler(generateBatchEmbeddingsHandler, {\r\n  rateLimit: {\r\n    ...rateLimitConfigs.embedding,\r\n    maxRequests: 20, // More restrictive for batch operations\r\n  },\r\n  logging: {\r\n    enabled: true,\r\n    includeBody: false, // Don't log text content for privacy\r\n  },\r\n})"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}