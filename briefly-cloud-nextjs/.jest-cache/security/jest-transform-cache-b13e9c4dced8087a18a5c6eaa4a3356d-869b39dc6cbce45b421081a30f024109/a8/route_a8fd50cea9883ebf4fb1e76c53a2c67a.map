{"version":3,"names":["GET","cov_2ddf4iw21y","f","s","POST","SUPPORTED_FILE_TYPES","ext","category","TIER_LIMITS","free","maxFileSize","maxFiles","totalStorage","pro","pro_byok","uploadHandler","request","context","user","b","_apiutils","ApiResponse","unauthorized","supabase","_supabase","supabaseAdmin","formData","file","get","metadata","JSON","parse","badRequest","userProfileKey","_cache","CACHE_KEYS","USER_PROFILE","id","userProfile","cacheManager","data","error","profileError1","_performance","withApiPerformanceMonitoring","from","select","eq","single","console","internalError","set","profileError","tier","subscription_tier","tierLimits","currentFileCount","documents_uploaded","_apierrors","createError","usageLimitExceeded","currentStorage","storage_used_bytes","size","validation","validateFileUpload","maxSize","allowedTypes","Object","keys","success","type","join","fileExtension","timestamp","Date","now","randomId","Math","random","toString","substring","fileName","fileBuffer","arrayBuffer","uploadData","uploadError","storage","upload","contentType","originalName","name","uploadedBy","uploadedAt","toISOString","urlData","getPublicUrl","fileMetadata","user_id","path","mime_type","source","external_id","external_url","publicUrl","processed","processing_status","extension","uploaded_at","original_name","metadataResult","metadataError","insert","remove","fileId","extractTextFromBuffer","Promise","resolve","then","_interop_require_wildcard","require","extraction","Buffer","processDocument","text","fileType","fileSize","processingError","update","_logger","logApiUsage","file_name","Error","message","usageError","updated_at","delete","file_size","file_type","created","url","usage","files_used","files_limit","storage_used","storage_limit","storage_used_formatted","formatFileSize","storage_limit_formatted","getUploadInfoHandler","uploadInfo","supported_types","supported_extensions","values","map","t","limits","max_file_size","max_file_size_formatted","max_files","total_storage","total_storage_formatted","current_usage","files_uploaded","files_remaining","max","storage_remaining","storage_remaining_formatted","withPerformanceMonitoring","_apimiddleware","createProtectedApiHandler","rateLimit","_ratelimit","rateLimitConfigs","logging","enabled","includeBody","general"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\upload\\route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createProtectedApiHandler, ApiContext } from '@/app/lib/api-middleware'\r\nimport { ApiResponse, validateFileUpload, formatFileSize } from '@/app/lib/api-utils'\r\nimport { rateLimitConfigs } from '@/app/lib/rate-limit'\r\nimport { supabaseAdmin } from '@/app/lib/supabase'\r\nimport { logApiUsage } from '@/app/lib/logger'\r\nimport { createError } from '@/app/lib/api-errors'\r\nimport { cacheManager, CACHE_KEYS } from '@/app/lib/cache'\r\nimport { withPerformanceMonitoring, withApiPerformanceMonitoring } from '@/app/lib/performance'\r\n\r\n// Supported file types and their MIME types\r\nconst SUPPORTED_FILE_TYPES = {\r\n  // Documents\r\n  'application/pdf': { ext: 'pdf', category: 'document' },\r\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document': { ext: 'docx', category: 'document' },\r\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation': { ext: 'pptx', category: 'document' },\r\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': { ext: 'xlsx', category: 'document' },\r\n  \r\n  // Text files\r\n  'text/plain': { ext: 'txt', category: 'text' },\r\n  'text/markdown': { ext: 'md', category: 'text' },\r\n  'text/csv': { ext: 'csv', category: 'data' },\r\n  'application/csv': { ext: 'csv', category: 'data' },\r\n  \r\n  // Legacy Office formats\r\n  'application/msword': { ext: 'doc', category: 'document' },\r\n  'application/vnd.ms-excel': { ext: 'xls', category: 'document' },\r\n  'application/vnd.ms-powerpoint': { ext: 'ppt', category: 'document' },\r\n}\r\n\r\n// Tier-based file size limits (in bytes)\r\nconst TIER_LIMITS = {\r\n  free: {\r\n    maxFileSize: 10 * 1024 * 1024, // 10MB\r\n    maxFiles: 25,\r\n    totalStorage: 100 * 1024 * 1024, // 100MB\r\n  },\r\n  pro: {\r\n    maxFileSize: 50 * 1024 * 1024, // 50MB\r\n    maxFiles: 500,\r\n    totalStorage: 1024 * 1024 * 1024, // 1GB\r\n  },\r\n  pro_byok: {\r\n    maxFileSize: 100 * 1024 * 1024, // 100MB\r\n    maxFiles: 5000,\r\n    totalStorage: 10 * 1024 * 1024 * 1024, // 10GB\r\n  },\r\n}\r\n\r\n// POST /api/upload - Handle file upload\r\nasync function uploadHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const supabase = supabaseAdmin\r\n    \r\n    // Parse multipart form data\r\n    const formData = await request.formData()\r\n    const file = formData.get('file') as File\r\n    const metadata = formData.get('metadata') ? JSON.parse(formData.get('metadata') as string) : {}\r\n    \r\n    if (!file) {\r\n      return ApiResponse.badRequest('No file provided')\r\n    }\r\n    \r\n    // Get user's current tier and usage with caching\r\n    const userProfileKey = CACHE_KEYS.USER_PROFILE(user.id)\r\n    let userProfile = cacheManager.get(userProfileKey)\r\n    \r\n    if (!userProfile) {\r\n      const { data, error: profileError } = await withApiPerformanceMonitoring(() =>\r\n        supabase\r\n          .from('users')\r\n          .select('subscription_tier, documents_uploaded, documents_limit, storage_used_bytes, storage_limit_bytes')\r\n          .eq('id', user.id)\r\n          .single()\r\n      )\r\n      \r\n      if (profileError) {\r\n        console.error('Profile fetch error:', profileError)\r\n        return ApiResponse.internalError('Failed to fetch user profile')\r\n      }\r\n      \r\n      userProfile = data\r\n      // Cache user profile for 5 minutes\r\n      cacheManager.set(userProfileKey, userProfile, 1000 * 60 * 5)\r\n    }\r\n    \r\n    if (profileError) {\r\n      console.error('Profile fetch error:', profileError)\r\n      return ApiResponse.internalError('Failed to fetch user profile')\r\n    }\r\n    \r\n    const tier = userProfile.subscription_tier || 'free'\r\n    const tierLimits = TIER_LIMITS[tier as keyof typeof TIER_LIMITS] || TIER_LIMITS.free\r\n    \r\n    // Check file count limits\r\n    const currentFileCount = userProfile.documents_uploaded || 0\r\n    if (currentFileCount >= tierLimits.maxFiles) {\r\n      throw createError.usageLimitExceeded(\r\n        'documents',\r\n        tier,\r\n        currentFileCount,\r\n        tierLimits.maxFiles\r\n      )\r\n    }\r\n    \r\n    // Check storage limits\r\n    const currentStorage = userProfile.storage_used_bytes || 0\r\n    if (currentStorage + file.size > tierLimits.totalStorage) {\r\n      throw createError.usageLimitExceeded(\r\n        'storage',\r\n        tier,\r\n        currentStorage,\r\n        tierLimits.totalStorage\r\n      )\r\n    }\r\n    \r\n    // Validate file\r\n    const validation = validateFileUpload(file, {\r\n      maxSize: tierLimits.maxFileSize,\r\n      allowedTypes: Object.keys(SUPPORTED_FILE_TYPES),\r\n    })\r\n    \r\n    if (!validation.success) {\r\n      return ApiResponse.badRequest(validation.error!)\r\n    }\r\n    \r\n    // Check if file type is supported\r\n    if (!SUPPORTED_FILE_TYPES[file.type as keyof typeof SUPPORTED_FILE_TYPES]) {\r\n      return ApiResponse.badRequest(\r\n        `File type ${file.type} is not supported. Supported types: ${Object.keys(SUPPORTED_FILE_TYPES).join(', ')}`\r\n      )\r\n    }\r\n    \r\n    // Generate unique file path\r\n    const fileExtension = SUPPORTED_FILE_TYPES[file.type as keyof typeof SUPPORTED_FILE_TYPES].ext\r\n    const timestamp = Date.now()\r\n    const randomId = Math.random().toString(36).substring(2, 15)\r\n    const fileName = `${user.id}/${timestamp}_${randomId}.${fileExtension}`\r\n    \r\n    // Convert File to ArrayBuffer for Supabase Storage\r\n    const fileBuffer = await file.arrayBuffer()\r\n    \r\n    // Upload to Supabase Storage\r\n    const { data: uploadData, error: uploadError } = await supabase.storage\r\n      .from('documents')\r\n      .upload(fileName, fileBuffer, {\r\n        contentType: file.type,\r\n        metadata: {\r\n          originalName: file.name,\r\n          uploadedBy: user.id,\r\n          uploadedAt: new Date().toISOString(),\r\n          ...metadata,\r\n        },\r\n      })\r\n    \r\n    if (uploadError) {\r\n      console.error('File upload error:', uploadError)\r\n      return ApiResponse.internalError('Failed to upload file to storage')\r\n    }\r\n    \r\n    // Get the public URL\r\n    const { data: urlData } = supabase.storage\r\n      .from('documents')\r\n      .getPublicUrl(fileName)\r\n    \r\n    // Create file metadata record\r\n    const fileMetadata = {\r\n      id: `${timestamp}_${randomId}`,\r\n      user_id: user.id,\r\n      name: file.name,\r\n      path: fileName,\r\n      size: file.size,\r\n      mime_type: file.type,\r\n      source: 'upload',\r\n      external_id: uploadData.id,\r\n      external_url: urlData.publicUrl,\r\n      processed: false,\r\n      processing_status: 'pending',\r\n      metadata: {\r\n        category: SUPPORTED_FILE_TYPES[file.type as keyof typeof SUPPORTED_FILE_TYPES].category,\r\n        extension: fileExtension,\r\n        uploaded_at: new Date().toISOString(),\r\n        original_name: file.name,\r\n        ...metadata,\r\n      },\r\n    }\r\n    \r\n    // Insert file metadata\r\n    const { data: metadataResult, error: metadataError } = await supabase\r\n      .from('file_metadata')\r\n      .insert(fileMetadata)\r\n      .select()\r\n      .single()\r\n    \r\n    if (metadataError) {\r\n      console.error('Metadata insert error:', metadataError)\r\n      \r\n      // Clean up uploaded file if metadata insertion fails\r\n      await supabase.storage.from('documents').remove([fileName])\r\n      \r\n      return ApiResponse.internalError('Failed to save file metadata')\r\n    }\r\n\r\n    // Automatic indexing with new pgvector pipeline\r\n    const fileId = metadataResult.id\r\n    \r\n    try {\r\n      // 1) Extract text from the uploaded buffer\r\n      const { extractTextFromBuffer } = await import('@/app/lib/document-extractor')\r\n      const extraction = await extractTextFromBuffer(Buffer.from(fileBuffer), file.type, file.name)\r\n      \r\n      // 2) Process document with new vector pipeline\r\n      const { processDocument } = await import('@/app/lib/vector/document-processor')\r\n      await processDocument(user.id, fileId, file.name, extraction.text, {\r\n        fileType: file.type,\r\n        fileSize: file.size,\r\n        uploadedAt: new Date().toISOString(),\r\n        source: 'upload'\r\n      })\r\n        \r\n    } catch (processingError) {\r\n      console.error('File processing error:', processingError)\r\n      \r\n      // Mark as failed but don't fail the upload\r\n      await supabaseAdmin\r\n        .from('app.files')\r\n        .update({ processed: false, processing_status: 'failed' })\r\n        .eq('id', fileId)\r\n        .eq('user_id', user.id)\r\n        \r\n      // Log the processing error but continue with upload success\r\n      logApiUsage(user.id, '/api/upload', 'processing_failed', {\r\n        file_name: file.name,\r\n        error: processingError instanceof Error ? processingError.message : 'Unknown error'\r\n      })\r\n    }\r\n    \r\n    // Update user usage statistics\r\n    const { error: usageError } = await withApiPerformanceMonitoring(() =>\r\n      supabase\r\n        .from('users')\r\n        .update({\r\n          documents_uploaded: currentFileCount + 1,\r\n          storage_used_bytes: currentStorage + file.size,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', user.id)\r\n    )\r\n    \r\n    if (usageError) {\r\n      console.error('Usage update error:', usageError)\r\n      // Don't fail the upload for this, just log it\r\n    }\r\n    \r\n    // Invalidate user profile cache after update\r\n    cacheManager.delete(userProfileKey)\r\n    \r\n    // Log usage for analytics\r\n    logApiUsage(user.id, '/api/upload', 'file_upload', {\r\n      file_name: file.name,\r\n      file_size: file.size,\r\n      file_type: file.type,\r\n      tier,\r\n    })\r\n    \r\n    // Return success response\r\n    return ApiResponse.created({\r\n      file: {\r\n        id: metadataResult.id,\r\n        name: file.name,\r\n        size: file.size,\r\n        type: file.type,\r\n        url: urlData.publicUrl,\r\n        uploaded_at: new Date().toISOString(),\r\n        processing_status: 'pending',\r\n      },\r\n      usage: {\r\n        files_used: currentFileCount + 1,\r\n        files_limit: tierLimits.maxFiles,\r\n        storage_used: currentStorage + file.size,\r\n        storage_limit: tierLimits.totalStorage,\r\n        storage_used_formatted: formatFileSize(currentStorage + file.size),\r\n        storage_limit_formatted: formatFileSize(tierLimits.totalStorage),\r\n      },\r\n    }, 'File uploaded successfully')\r\n    \r\n  } catch (error) {\r\n    console.error('Upload handler error:', error)\r\n    \r\n    // Re-throw known errors\r\n    if (error instanceof Error && error.name === 'AppError') {\r\n      throw error\r\n    }\r\n    \r\n    return ApiResponse.internalError('Failed to process file upload')\r\n  }\r\n}\r\n\r\n// GET /api/upload - Get upload status and limits\r\nasync function getUploadInfoHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const supabase = supabaseAdmin\r\n    \r\n    // Get user's current usage\r\n    const { data: userProfile, error: profileError } = await supabase\r\n      .from('users')\r\n      .select('subscription_tier, documents_uploaded, documents_limit, storage_used_bytes, storage_limit_bytes')\r\n      .eq('id', user.id)\r\n      .single()\r\n    \r\n    if (profileError) {\r\n      console.error('Profile fetch error:', profileError)\r\n      return ApiResponse.internalError('Failed to fetch user profile')\r\n    }\r\n    \r\n    const tier = userProfile.subscription_tier || 'free'\r\n    const tierLimits = TIER_LIMITS[tier as keyof typeof TIER_LIMITS] || TIER_LIMITS.free\r\n    \r\n    const uploadInfo = {\r\n      supported_types: Object.keys(SUPPORTED_FILE_TYPES),\r\n      supported_extensions: Object.values(SUPPORTED_FILE_TYPES).map(t => t.ext),\r\n      limits: {\r\n        max_file_size: tierLimits.maxFileSize,\r\n        max_file_size_formatted: formatFileSize(tierLimits.maxFileSize),\r\n        max_files: tierLimits.maxFiles,\r\n        total_storage: tierLimits.totalStorage,\r\n        total_storage_formatted: formatFileSize(tierLimits.totalStorage),\r\n      },\r\n      current_usage: {\r\n        files_uploaded: userProfile.documents_uploaded || 0,\r\n        files_remaining: Math.max(0, tierLimits.maxFiles - (userProfile.documents_uploaded || 0)),\r\n        storage_used: userProfile.storage_used_bytes || 0,\r\n        storage_used_formatted: formatFileSize(userProfile.storage_used_bytes || 0),\r\n        storage_remaining: Math.max(0, tierLimits.totalStorage - (userProfile.storage_used_bytes || 0)),\r\n        storage_remaining_formatted: formatFileSize(Math.max(0, tierLimits.totalStorage - (userProfile.storage_used_bytes || 0))),\r\n      },\r\n      tier,\r\n    }\r\n    \r\n    return ApiResponse.success(uploadInfo)\r\n    \r\n  } catch (error) {\r\n    console.error('Upload info handler error:', error)\r\n    return ApiResponse.internalError('Failed to get upload information')\r\n  }\r\n}\r\n\r\n// Export handlers with middleware and performance monitoring\r\nexport const POST = withPerformanceMonitoring(\r\n  createProtectedApiHandler(uploadHandler, {\r\n    rateLimit: rateLimitConfigs.upload,\r\n    logging: {\r\n      enabled: true,\r\n      includeBody: false, // Don't log file content\r\n    },\r\n  })\r\n)\r\n\r\nexport const GET = withPerformanceMonitoring(\r\n  createProtectedApiHandler(getUploadInfoHandler, {\r\n    rateLimit: rateLimitConfigs.general,\r\n    logging: {\r\n      enabled: true,\r\n      includeBody: false,\r\n    },\r\n  })\r\n)"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}