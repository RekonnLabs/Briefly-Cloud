{"version":3,"names":["cov_2i1subnayr","actualCoverage","s","GET","TIER_LIMITS","free","documents","chat_messages","api_calls","storage_bytes","pro","pro_byok","getUserUsageHandler","request","context","f","user","b","_apiutils","ApiResponse","unauthorized","supabase","_supabase","supabaseAdmin","url","URL","timeframe","searchParams","get","includeHistory","data","userProfile","error","profileError","from","select","eq","id","single","console","internalError","tierLimits","subscription_tier","currentUsage","used","chat_messages_count","limit","chat_messages_limit","percentage","Math","round","remaining","max","documents_uploaded","documents_limit","api_calls_count","api_calls_limit","storage","storage_used_bytes","storage_limit_bytes","used_formatted","formatBytes","limit_formatted","usageHistory","pagination","parsePaginationParams","now","Date","startDate","getTime","getFullYear","getMonth","usageLogs","logsError","count","gte","toISOString","order","ascending","range","offset","createPaginatedResponse","warnings","Object","entries","forEach","key","usage","push","type","level","message","replace","_logger","logApiUsage","include_history","responseData","usage_reset_date","current_usage","tier_limits","usage_history","success","bytes","units","size","unitIndex","length","toFixed","_apimiddleware","createProtectedApiHandler","rateLimit","_ratelimit","rateLimitConfigs","general","logging","enabled","includeBody"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\user\\usage\\route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createProtectedApiHandler, ApiContext } from '@/app/lib/api-middleware'\r\nimport { ApiResponse, parsePaginationParams, createPaginatedResponse } from '@/app/lib/api-utils'\r\nimport { rateLimitConfigs } from '@/app/lib/rate-limit'\r\nimport { supabaseAdmin } from '@/app/lib/supabase'\r\nimport { logApiUsage } from '@/app/lib/logger'\r\n\r\n// Tier limits for reference\r\nconst TIER_LIMITS = {\r\n  free: {\r\n    documents: 10,\r\n    chat_messages: 100,\r\n    api_calls: 1000,\r\n    storage_bytes: 104857600, // 100MB\r\n  },\r\n  pro: {\r\n    documents: 1000,\r\n    chat_messages: 1000,\r\n    api_calls: 10000,\r\n    storage_bytes: 10737418240, // 10GB\r\n  },\r\n  pro_byok: {\r\n    documents: 10000,\r\n    chat_messages: 5000,\r\n    api_calls: 50000,\r\n    storage_bytes: 107374182400, // 100GB\r\n  }\r\n}\r\n\r\n// GET /api/user/usage - Get user usage statistics\r\nasync function getUserUsageHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const supabase = supabaseAdmin\r\n    \r\n    const url = new URL(request.url)\r\n    const timeframe = url.searchParams.get('timeframe') || 'current_month'\r\n    const includeHistory = url.searchParams.get('include_history') === 'true'\r\n    \r\n    // Get current usage from user profile\r\n    const { data: userProfile, error: profileError } = await supabase\r\n      .from('users')\r\n      .select(`\r\n        subscription_tier,\r\n        chat_messages_count,\r\n        chat_messages_limit,\r\n        documents_uploaded,\r\n        documents_limit,\r\n        api_calls_count,\r\n        api_calls_limit,\r\n        storage_used_bytes,\r\n        storage_limit_bytes,\r\n        usage_reset_date\r\n      `)\r\n      .eq('id', user.id)\r\n      .single()\r\n    \r\n    if (profileError) {\r\n      console.error('Profile fetch error:', profileError)\r\n      return ApiResponse.internalError('Failed to fetch usage data')\r\n    }\r\n    \r\n    // Get tier limits\r\n    const tierLimits = TIER_LIMITS[userProfile.subscription_tier as keyof typeof TIER_LIMITS] || TIER_LIMITS.free\r\n    \r\n    // Calculate usage statistics\r\n    const currentUsage = {\r\n      chat_messages: {\r\n        used: userProfile.chat_messages_count || 0,\r\n        limit: userProfile.chat_messages_limit || tierLimits.chat_messages,\r\n        percentage: Math.round(((userProfile.chat_messages_count || 0) / (userProfile.chat_messages_limit || tierLimits.chat_messages)) * 100),\r\n        remaining: Math.max(0, (userProfile.chat_messages_limit || tierLimits.chat_messages) - (userProfile.chat_messages_count || 0))\r\n      },\r\n      documents: {\r\n        used: userProfile.documents_uploaded || 0,\r\n        limit: userProfile.documents_limit || tierLimits.documents,\r\n        percentage: Math.round(((userProfile.documents_uploaded || 0) / (userProfile.documents_limit || tierLimits.documents)) * 100),\r\n        remaining: Math.max(0, (userProfile.documents_limit || tierLimits.documents) - (userProfile.documents_uploaded || 0))\r\n      },\r\n      api_calls: {\r\n        used: userProfile.api_calls_count || 0,\r\n        limit: userProfile.api_calls_limit || tierLimits.api_calls,\r\n        percentage: Math.round(((userProfile.api_calls_count || 0) / (userProfile.api_calls_limit || tierLimits.api_calls)) * 100),\r\n        remaining: Math.max(0, (userProfile.api_calls_limit || tierLimits.api_calls) - (userProfile.api_calls_count || 0))\r\n      },\r\n      storage: {\r\n        used: userProfile.storage_used_bytes || 0,\r\n        limit: userProfile.storage_limit_bytes || tierLimits.storage_bytes,\r\n        percentage: Math.round(((userProfile.storage_used_bytes || 0) / (userProfile.storage_limit_bytes || tierLimits.storage_bytes)) * 100),\r\n        remaining: Math.max(0, (userProfile.storage_limit_bytes || tierLimits.storage_bytes) - (userProfile.storage_used_bytes || 0)),\r\n        used_formatted: formatBytes(userProfile.storage_used_bytes || 0),\r\n        limit_formatted: formatBytes(userProfile.storage_limit_bytes || tierLimits.storage_bytes)\r\n      }\r\n    }\r\n    \r\n    let usageHistory = null\r\n    \r\n    // Get usage history if requested\r\n    if (includeHistory) {\r\n      const pagination = parsePaginationParams(url.searchParams)\r\n      \r\n      // Calculate date range based on timeframe\r\n      const now = new Date()\r\n      let startDate: Date\r\n      \r\n      switch (timeframe) {\r\n        case 'last_7_days':\r\n          startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)\r\n          break\r\n        case 'last_30_days':\r\n          startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000)\r\n          break\r\n        case 'current_month':\r\n          startDate = new Date(now.getFullYear(), now.getMonth(), 1)\r\n          break\r\n        case 'last_month':\r\n          startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1)\r\n          break\r\n        default:\r\n          startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000)\r\n      }\r\n      \r\n      // Get usage logs\r\n      const { data: usageLogs, error: logsError, count } = await supabase\r\n        .from('usage_logs')\r\n        .select('*', { count: 'exact' })\r\n        .eq('user_id', user.id)\r\n        .gte('created_at', startDate.toISOString())\r\n        .order('created_at', { ascending: false })\r\n        .range(pagination.offset!, pagination.offset! + pagination.limit! - 1)\r\n      \r\n      if (logsError) {\r\n        console.error('Usage logs fetch error:', logsError)\r\n      } else {\r\n        usageHistory = createPaginatedResponse(usageLogs || [], count || 0, pagination)\r\n      }\r\n    }\r\n    \r\n    // Get usage warnings\r\n    const warnings: Array<{\r\n      type: string\r\n      level: 'warning' | 'critical'\r\n      message: string\r\n    }> = []\r\n    \r\n    Object.entries(currentUsage).forEach(([key, usage]) => {\r\n      if (usage.percentage >= 90) {\r\n        warnings.push({\r\n          type: key,\r\n          level: 'critical',\r\n          message: `You have used ${usage.percentage}% of your ${key.replace('_', ' ')} limit`\r\n        })\r\n      } else if (usage.percentage >= 80) {\r\n        warnings.push({\r\n          type: key,\r\n          level: 'warning',\r\n          message: `You have used ${usage.percentage}% of your ${key.replace('_', ' ')} limit`\r\n        })\r\n      }\r\n    })\r\n    \r\n    // Log usage\r\n    logApiUsage(user.id, '/api/user/usage', 'usage_view', {\r\n      timeframe,\r\n      include_history: includeHistory\r\n    })\r\n    \r\n    const responseData = {\r\n      subscription_tier: userProfile.subscription_tier,\r\n      usage_reset_date: userProfile.usage_reset_date,\r\n      current_usage: currentUsage,\r\n      warnings,\r\n      tier_limits: tierLimits,\r\n      ...(usageHistory && { usage_history: usageHistory })\r\n    }\r\n    \r\n    return ApiResponse.success(responseData)\r\n    \r\n  } catch (error) {\r\n    console.error('Usage handler error:', error)\r\n    return ApiResponse.internalError('Failed to process usage request')\r\n  }\r\n}\r\n\r\n// Helper function to format bytes\r\nfunction formatBytes(bytes: number): string {\r\n  const units = ['B', 'KB', 'MB', 'GB', 'TB']\r\n  let size = bytes\r\n  let unitIndex = 0\r\n  \r\n  while (size >= 1024 && unitIndex < units.length - 1) {\r\n    size /= 1024\r\n    unitIndex++\r\n  }\r\n  \r\n  return `${size.toFixed(1)} ${units[unitIndex]}`\r\n}\r\n\r\n// Export handler with middleware\r\nexport const GET = createProtectedApiHandler(getUserUsageHandler, {\r\n  rateLimit: rateLimitConfigs.general,\r\n  logging: {\r\n    enabled: true,\r\n    includeBody: false,\r\n  },\r\n})"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}