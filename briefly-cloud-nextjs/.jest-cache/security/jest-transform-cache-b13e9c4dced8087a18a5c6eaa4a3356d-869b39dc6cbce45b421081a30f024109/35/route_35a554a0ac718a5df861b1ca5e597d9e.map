{"version":3,"names":["cov_3fvx8kj75","actualCoverage","s","GET","req","f","origin","nextUrl","redirectUri","state","crypto","randomUUID","_headers","cookies","set","httpOnly","sameSite","secure","process","env","NODE_ENV","path","maxAge","scope","join","url","URL","searchParams","GOOGLE_CLIENT_ID","_server","NextResponse","redirect","toString"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\storage\\google\\start\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const origin = req.nextUrl.origin\r\n  const redirectUri = `${origin}/api/storage/google/callback`\r\n  \r\n  // Generate CSRF state token\r\n  const state = crypto.randomUUID()\r\n  cookies().set('oauth_state_google', state, { \r\n    httpOnly: true, \r\n    sameSite: 'lax', \r\n    secure: process.env.NODE_ENV === 'production',\r\n    path: '/',\r\n    maxAge: 600 // 10 minutes\r\n  })\r\n  \r\n  // Storage-specific scopes for Google Drive access\r\n  const scope = [\r\n    'openid',\r\n    'email', \r\n    'profile',\r\n    'https://www.googleapis.com/auth/drive.file',\r\n    'https://www.googleapis.com/auth/drive.metadata.readonly',\r\n  ].join(' ')\r\n  \r\n  const url = new URL('https://accounts.google.com/o/oauth2/v2/auth')\r\n  url.searchParams.set('client_id', process.env.GOOGLE_CLIENT_ID!)\r\n  url.searchParams.set('redirect_uri', redirectUri)\r\n  url.searchParams.set('response_type', 'code')\r\n  url.searchParams.set('access_type', 'offline')\r\n  url.searchParams.set('prompt', 'consent')\r\n  url.searchParams.set('scope', scope)\r\n  url.searchParams.set('state', state)\r\n  \r\n  return NextResponse.redirect(url.toString())\r\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAOE;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;AAAAA,aAAA,GAAAE,CAAA;;;;;;+BAJoB;;;;;;WAAAC,GAAA;;;;;iCAHoB;;;iCAClB;AAEjB,eAAeA,IAAIC,GAAgB;EAAA;EAAAJ,aAAA,GAAAK,CAAA;EACxC,MAAMC,MAAA;EAAA;EAAA,CAAAN,aAAA,GAAAE,CAAA,OAASE,GAAA,CAAIG,OAAO,CAACD,MAAM;EACjC,MAAME,WAAA;EAAA;EAAA,CAAAR,aAAA,GAAAE,CAAA,OAAc,GAAGI,MAAA,8BAAoC;EAE3D;EACA,MAAMG,KAAA;EAAA;EAAA,CAAAT,aAAA,GAAAE,CAAA,OAAQQ,MAAA,CAAOC,UAAU;EAAA;EAAAX,aAAA,GAAAE,CAAA;EAC/B,IAAAU,QAAA,CAAAC,OAAO,IAAGC,GAAG,CAAC,sBAAsBL,KAAA,EAAO;IACzCM,QAAA,EAAU;IACVC,QAAA,EAAU;IACVC,MAAA,EAAQC,OAAA,CAAQC,GAAG,CAACC,QAAQ,KAAK;IACjCC,IAAA,EAAM;IACNC,MAAA,EAAQ,IAAI;EACd;EAEA;EACA,MAAMC,KAAA;EAAA;EAAA,CAAAvB,aAAA,GAAAE,CAAA,OAAQ,CACZ,UACA,SACA,WACA,8CACA,0DACD,CAACsB,IAAI,CAAC;EAEP,MAAMC,GAAA;EAAA;EAAA,CAAAzB,aAAA,GAAAE,CAAA,QAAM,IAAIwB,GAAA,CAAI;EAAA;EAAA1B,aAAA,GAAAE,CAAA;EACpBuB,GAAA,CAAIE,YAAY,CAACb,GAAG,CAAC,aAAaI,OAAA,CAAQC,GAAG,CAACS,gBAAgB;EAAA;EAAA5B,aAAA,GAAAE,CAAA;EAC9DuB,GAAA,CAAIE,YAAY,CAACb,GAAG,CAAC,gBAAgBN,WAAA;EAAA;EAAAR,aAAA,GAAAE,CAAA;EACrCuB,GAAA,CAAIE,YAAY,CAACb,GAAG,CAAC,iBAAiB;EAAA;EAAAd,aAAA,GAAAE,CAAA;EACtCuB,GAAA,CAAIE,YAAY,CAACb,GAAG,CAAC,eAAe;EAAA;EAAAd,aAAA,GAAAE,CAAA;EACpCuB,GAAA,CAAIE,YAAY,CAACb,GAAG,CAAC,UAAU;EAAA;EAAAd,aAAA,GAAAE,CAAA;EAC/BuB,GAAA,CAAIE,YAAY,CAACb,GAAG,CAAC,SAASS,KAAA;EAAA;EAAAvB,aAAA,GAAAE,CAAA;EAC9BuB,GAAA,CAAIE,YAAY,CAACb,GAAG,CAAC,SAASL,KAAA;EAAA;EAAAT,aAAA,GAAAE,CAAA;EAE9B,OAAO2B,OAAA,CAAAC,YAAY,CAACC,QAAQ,CAACN,GAAA,CAAIO,QAAQ;AAC3C","ignoreList":[]}