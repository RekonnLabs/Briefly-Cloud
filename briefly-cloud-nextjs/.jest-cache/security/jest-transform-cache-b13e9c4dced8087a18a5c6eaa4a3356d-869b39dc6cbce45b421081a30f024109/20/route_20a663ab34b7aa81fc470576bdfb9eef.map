{"version":3,"names":["GET","cov_1s4eda6hhm","f","s","PATCH","POST","AlertSchema","_zod","z","object","type","string","message","severity","enum","timestamp","datetime","metrics","record","any","optional","context","request","_ratelimit","withRateLimit","body","json","alerts","array","parse","supabase","_supabase","supabaseAdmin","alertRecords","map","alert","id","crypto","randomUUID","b","created_at","Date","toISOString","status","error","from","insert","_logger","logger","_apierrors","formatErrorResponse","criticalAlerts","filter","length","sendCriticalAlerts","warn","count","criticalCount","_server","NextResponse","success","searchParams","URL","url","hours","parseInt","get","cutoffDate","setHours","getHours","query","select","gte","order","ascending","eq","data","alertStats","reduce","stats","totalAlerts","bySeverity","byType","statistics","summary","alertRate","timeRange","alertId","update","updated_at","info","sendToSlack","sendEmailAlerts","sendSMSAlerts","webhookUrl","process","env","SLACK_WEBHOOK_URL","blocks","text","toUpperCase","toLocaleString","fetch","method","headers","JSON","stringify","adminEmail","ADMIN_EMAIL","emailContent","join","to","subject","content","adminPhone","ADMIN_PHONE"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\monitoring\\alerts\\route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { z } from 'zod'\r\nimport { logger } from '@/app/lib/logger'\r\nimport { formatErrorResponse } from '@/app/lib/api-errors'\r\nimport { withRateLimit } from '@/app/lib/rate-limit'\r\nimport { createClient } from '@supabase/supabase-js'\r\nimport { supabaseAdmin } from '@/app/lib/supabase'\n\r\n// Alert schema\r\nconst AlertSchema = z.object({\r\n  type: z.string(),\r\n  message: z.string(),\r\n  severity: z.enum(['low', 'medium', 'high', 'critical']),\r\n  timestamp: z.string().datetime(),\r\n  metrics: z.record(z.any()).optional(),\r\n  context: z.record(z.any()).optional(),\r\n})\r\n\r\nexport async function POST(request: NextRequest) {\r\n  return withRateLimit(request, async () => {\r\n    try {\r\n      const body = await request.json()\r\n      const { alerts } = z.object({\r\n        alerts: z.array(AlertSchema),\r\n      }).parse(body)\r\n\r\n      // Store alerts in database\r\n      const supabase = supabaseAdmin\r\n\r\n      const alertRecords = alerts.map(alert => ({\r\n        id: crypto.randomUUID(),\r\n        type: alert.type,\r\n        message: alert.message,\r\n        severity: alert.severity,\r\n        metrics: alert.metrics || {},\r\n        context: alert.context || {},\r\n        timestamp: alert.timestamp,\r\n        created_at: new Date().toISOString(),\r\n        status: 'active',\r\n      }))\r\n\r\n      const { error } = await supabase\r\n        .from('monitoring_alerts')\r\n        .insert(alertRecords)\r\n\r\n      if (error) {\r\n        logger.error('Failed to store alerts', { error })\r\n        return formatErrorResponse('Failed to store alerts', 500)\r\n      }\r\n\r\n      // Send critical alerts immediately\r\n      const criticalAlerts = alerts.filter(alert => alert.severity === 'critical')\r\n      if (criticalAlerts.length > 0) {\r\n        await sendCriticalAlerts(criticalAlerts)\r\n      }\r\n\r\n      logger.warn('Alerts stored', { \r\n        count: alerts.length,\r\n        criticalCount: criticalAlerts.length \r\n      })\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: `${alerts.length} alerts stored successfully`\r\n      })\r\n\r\n    } catch (error) {\r\n      logger.error('Alert storage error', { error })\r\n      return formatErrorResponse('Invalid request', 400)\r\n    }\r\n  })\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  return withRateLimit(request, async () => {\r\n    try {\r\n      const { searchParams } = new URL(request.url)\r\n      const hours = parseInt(searchParams.get('hours') || '24')\r\n      const severity = searchParams.get('severity')\r\n      const status = searchParams.get('status') || 'active'\r\n\r\n      // Get alerts\r\n      const supabase = supabaseAdmin\r\n\r\n      const cutoffDate = new Date()\r\n      cutoffDate.setHours(cutoffDate.getHours() - hours)\r\n\r\n      let query = supabase\r\n        .from('monitoring_alerts')\r\n        .select('*')\r\n        .gte('created_at', cutoffDate.toISOString())\r\n        .order('created_at', { ascending: false })\r\n\r\n      if (severity) {\r\n        query = query.eq('severity', severity)\r\n      }\r\n\r\n      if (status) {\r\n        query = query.eq('status', status)\r\n      }\r\n\r\n      const { data: alerts, error } = await query\r\n\r\n      if (error) {\r\n        logger.error('Failed to get alerts', { error })\r\n        return formatErrorResponse('Failed to retrieve alerts', 500)\r\n      }\r\n\r\n      // Calculate alert statistics\r\n      const alertStats = alerts?.reduce((stats, alert) => {\r\n        stats.totalAlerts++\r\n        stats.bySeverity[alert.severity] = (stats.bySeverity[alert.severity] || 0) + 1\r\n        stats.byType[alert.type] = (stats.byType[alert.type] || 0) + 1\r\n        \r\n        if (alert.severity === 'critical' || alert.severity === 'high') {\r\n          stats.criticalAlerts++\r\n        }\r\n        \r\n        return stats\r\n      }, {\r\n        totalAlerts: 0,\r\n        criticalAlerts: 0,\r\n        bySeverity: {} as Record<string, number>,\r\n        byType: {} as Record<string, number>,\r\n      }) || {\r\n        totalAlerts: 0,\r\n        criticalAlerts: 0,\r\n        bySeverity: {},\r\n        byType: {},\r\n      }\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        data: {\r\n          alerts: alerts || [],\r\n          statistics: alertStats,\r\n          summary: {\r\n            totalAlerts: alertStats.totalAlerts,\r\n            criticalAlerts: alertStats.criticalAlerts,\r\n            alertRate: alertStats.totalAlerts / hours, // alerts per hour\r\n            timeRange: `${hours} hours`,\r\n          }\r\n        }\r\n      })\r\n\r\n    } catch (error) {\r\n      logger.error('Alerts retrieval error', { error })\r\n      return formatErrorResponse('Internal server error', 500)\r\n    }\r\n  })\r\n}\r\n\r\n// Update alert status\r\nexport async function PATCH(request: NextRequest) {\r\n  return withRateLimit(request, async () => {\r\n    try {\r\n      const body = await request.json()\r\n      const { alertId, status } = z.object({\r\n        alertId: z.string(),\r\n        status: z.enum(['active', 'acknowledged', 'resolved', 'dismissed']),\r\n      }).parse(body)\r\n\r\n      // Update alert status\r\n      const supabase = supabaseAdmin\r\n\r\n      const { error } = await supabase\r\n        .from('monitoring_alerts')\r\n        .update({ \r\n          status,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', alertId)\r\n\r\n      if (error) {\r\n        logger.error('Failed to update alert status', { error })\r\n        return formatErrorResponse('Failed to update alert', 500)\r\n      }\r\n\r\n      logger.info('Alert status updated', { alertId, status })\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: 'Alert status updated successfully'\r\n      })\r\n\r\n    } catch (error) {\r\n      logger.error('Alert status update error', { error })\r\n      return formatErrorResponse('Invalid request', 400)\r\n    }\r\n  })\r\n}\r\n\r\n// Send critical alerts via various channels\r\nasync function sendCriticalAlerts(alerts: any[]): Promise<void> {\r\n  try {\r\n    // Send to Slack/Teams/Discord\r\n    await sendToSlack(alerts)\r\n    \r\n    // Send email alerts\r\n    await sendEmailAlerts(alerts)\r\n    \r\n    // Send SMS alerts (if configured)\r\n    await sendSMSAlerts(alerts)\r\n    \r\n    logger.info('Critical alerts sent', { count: alerts.length })\r\n  } catch (error) {\r\n    logger.error('Failed to send critical alerts', { error })\r\n  }\r\n}\r\n\r\nasync function sendToSlack(alerts: any[]): Promise<void> {\r\n  const webhookUrl = process.env.SLACK_WEBHOOK_URL\r\n  if (!webhookUrl) return\r\n\r\n  try {\r\n    const blocks = alerts.map(alert => ({\r\n      type: 'section',\r\n      text: {\r\n        type: 'mrkdwn',\r\n        text: `ðŸš¨ *${alert.type.toUpperCase()}*\\n${alert.message}\\n*Severity:* ${alert.severity}\\n*Time:* ${new Date(alert.timestamp).toLocaleString()}`,\r\n      },\r\n    }))\r\n\r\n    await fetch(webhookUrl, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        text: `Critical Alert: ${alerts.length} new critical alerts`,\r\n        blocks,\r\n      }),\r\n    })\r\n  } catch (error) {\r\n    logger.error('Failed to send to Slack', { error })\r\n  }\r\n}\r\n\r\nasync function sendEmailAlerts(alerts: any[]): Promise<void> {\r\n  const adminEmail = process.env.ADMIN_EMAIL\r\n  if (!adminEmail) return\r\n\r\n  try {\r\n    // This would integrate with your email service (Resend, SendGrid, etc.)\r\n    const emailContent = alerts.map(alert => \r\n      `${alert.type}: ${alert.message} (${alert.severity})`\r\n    ).join('\\n\\n')\r\n\r\n    // Send email using your email service\r\n    logger.info('Email alert would be sent', { \r\n      to: adminEmail,\r\n      subject: `Critical Alerts: ${alerts.length} new alerts`,\r\n      content: emailContent \r\n    })\r\n  } catch (error) {\r\n    logger.error('Failed to send email alerts', { error })\r\n  }\r\n}\r\n\r\nasync function sendSMSAlerts(alerts: any[]): Promise<void> {\r\n  const adminPhone = process.env.ADMIN_PHONE\r\n  if (!adminPhone) return\r\n\r\n  try {\r\n    // This would integrate with your SMS service (Twilio, etc.)\r\n    const message = `Critical Alert: ${alerts.length} new critical alerts detected`\r\n    \r\n    logger.info('SMS alert would be sent', { \r\n      to: adminPhone,\r\n      message \r\n    })\r\n  } catch (error) {\r\n    logger.error('Failed to send SMS alerts', { error })\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}