2d5d07fa06f7e46136d9259dbc91a5f3
"use strict";

/* istanbul ignore next */
function cov_ixb893f5j() {
  var path = "R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\migration\\route.ts";
  var hash = "1335fb810663a2543630bee4876b912082390c8c";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\migration\\route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 6,
          column: 4
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "2": {
        start: {
          line: 6,
          column: 24
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "3": {
        start: {
          line: 11,
          column: 0
        },
        end: {
          line: 18,
          column: 3
        }
      },
      "4": {
        start: {
          line: 13,
          column: 8
        },
        end: {
          line: 13,
          column: 19
        }
      },
      "5": {
        start: {
          line: 16,
          column: 8
        },
        end: {
          line: 16,
          column: 20
        }
      },
      "6": {
        start: {
          line: 19,
          column: 16
        },
        end: {
          line: 19,
          column: 38
        }
      },
      "7": {
        start: {
          line: 20,
          column: 13
        },
        end: {
          line: 20,
          column: 27
        }
      },
      "8": {
        start: {
          line: 21,
          column: 19
        },
        end: {
          line: 21,
          column: 49
        }
      },
      "9": {
        start: {
          line: 22,
          column: 18
        },
        end: {
          line: 22,
          column: 38
        }
      },
      "10": {
        start: {
          line: 23,
          column: 14
        },
        end: {
          line: 23,
          column: 39
        }
      },
      "11": {
        start: {
          line: 24,
          column: 16
        },
        end: {
          line: 24,
          column: 43
        }
      },
      "12": {
        start: {
          line: 25,
          column: 19
        },
        end: {
          line: 25,
          column: 50
        }
      },
      "13": {
        start: {
          line: 26,
          column: 19
        },
        end: {
          line: 26,
          column: 50
        }
      },
      "14": {
        start: {
          line: 28,
          column: 31
        },
        end: {
          line: 42,
          column: 2
        }
      },
      "15": {
        start: {
          line: 44,
          column: 29
        },
        end: {
          line: 44,
          column: 38
        }
      },
      "16": {
        start: {
          line: 46,
          column: 4
        },
        end: {
          line: 82,
          column: 7
        }
      },
      "17": {
        start: {
          line: 47,
          column: 8
        },
        end: {
          line: 81,
          column: 9
        }
      },
      "18": {
        start: {
          line: 49,
          column: 28
        },
        end: {
          line: 49,
          column: 84
        }
      },
      "19": {
        start: {
          line: 50,
          column: 12
        },
        end: {
          line: 52,
          column: 13
        }
      },
      "20": {
        start: {
          line: 51,
          column: 16
        },
        end: {
          line: 51,
          column: 80
        }
      },
      "21": {
        start: {
          line: 54,
          column: 35
        },
        end: {
          line: 58,
          column: 38
        }
      },
      "22": {
        start: {
          line: 58,
          column: 27
        },
        end: {
          line: 58,
          column: 37
        }
      },
      "23": {
        start: {
          line: 59,
          column: 12
        },
        end: {
          line: 61,
          column: 13
        }
      },
      "24": {
        start: {
          line: 60,
          column: 16
        },
        end: {
          line: 60,
          column: 93
        }
      },
      "25": {
        start: {
          line: 62,
          column: 25
        },
        end: {
          line: 62,
          column: 45
        }
      },
      "26": {
        start: {
          line: 63,
          column: 39
        },
        end: {
          line: 63,
          column: 73
        }
      },
      "27": {
        start: {
          line: 64,
          column: 32
        },
        end: {
          line: 64,
          column: 68
        }
      },
      "28": {
        start: {
          line: 65,
          column: 32
        },
        end: {
          line: 65,
          column: 69
        }
      },
      "29": {
        start: {
          line: 66,
          column: 12
        },
        end: {
          line: 75,
          column: 13
        }
      },
      "30": {
        start: {
          line: 68,
          column: 20
        },
        end: {
          line: 68,
          column: 86
        }
      },
      "31": {
        start: {
          line: 70,
          column: 20
        },
        end: {
          line: 70,
          column: 83
        }
      },
      "32": {
        start: {
          line: 72,
          column: 20
        },
        end: {
          line: 72,
          column: 57
        }
      },
      "33": {
        start: {
          line: 74,
          column: 20
        },
        end: {
          line: 74,
          column: 86
        }
      },
      "34": {
        start: {
          line: 77,
          column: 12
        },
        end: {
          line: 79,
          column: 15
        }
      },
      "35": {
        start: {
          line: 80,
          column: 12
        },
        end: {
          line: 80,
          column: 85
        }
      },
      "36": {
        start: {
          line: 85,
          column: 4
        },
        end: {
          line: 102,
          column: 5
        }
      },
      "37": {
        start: {
          line: 86,
          column: 8
        },
        end: {
          line: 88,
          column: 11
        }
      },
      "38": {
        start: {
          line: 89,
          column: 23
        },
        end: {
          line: 89,
          column: 91
        }
      },
      "39": {
        start: {
          line: 91,
          column: 8
        },
        end: {
          line: 91,
          column: 52
        }
      },
      "40": {
        start: {
          line: 92,
          column: 8
        },
        end: {
          line: 96,
          column: 11
        }
      },
      "41": {
        start: {
          line: 98,
          column: 8
        },
        end: {
          line: 100,
          column: 11
        }
      },
      "42": {
        start: {
          line: 101,
          column: 8
        },
        end: {
          line: 101,
          column: 91
        }
      },
      "43": {
        start: {
          line: 105,
          column: 4
        },
        end: {
          line: 118,
          column: 5
        }
      },
      "44": {
        start: {
          line: 106,
          column: 8
        },
        end: {
          line: 106,
          column: 61
        }
      },
      "45": {
        start: {
          line: 107,
          column: 27
        },
        end: {
          line: 107,
          column: 96
        }
      },
      "46": {
        start: {
          line: 108,
          column: 8
        },
        end: {
          line: 112,
          column: 11
        }
      },
      "47": {
        start: {
          line: 114,
          column: 8
        },
        end: {
          line: 116,
          column: 11
        }
      },
      "48": {
        start: {
          line: 117,
          column: 8
        },
        end: {
          line: 117,
          column: 92
        }
      },
      "49": {
        start: {
          line: 121,
          column: 4
        },
        end: {
          line: 136,
          column: 5
        }
      },
      "50": {
        start: {
          line: 123,
          column: 25
        },
        end: {
          line: 123,
          column: 66
        }
      },
      "51": {
        start: {
          line: 124,
          column: 8
        },
        end: {
          line: 130,
          column: 11
        }
      },
      "52": {
        start: {
          line: 132,
          column: 8
        },
        end: {
          line: 134,
          column: 11
        }
      },
      "53": {
        start: {
          line: 135,
          column: 8
        },
        end: {
          line: 135,
          column: 94
        }
      },
      "54": {
        start: {
          line: 139,
          column: 4
        },
        end: {
          line: 162,
          column: 7
        }
      },
      "55": {
        start: {
          line: 140,
          column: 8
        },
        end: {
          line: 161,
          column: 9
        }
      },
      "56": {
        start: {
          line: 142,
          column: 28
        },
        end: {
          line: 142,
          column: 84
        }
      },
      "57": {
        start: {
          line: 143,
          column: 12
        },
        end: {
          line: 145,
          column: 13
        }
      },
      "58": {
        start: {
          line: 144,
          column: 16
        },
        end: {
          line: 144,
          column: 80
        }
      },
      "59": {
        start: {
          line: 147,
          column: 29
        },
        end: {
          line: 147,
          column: 70
        }
      },
      "60": {
        start: {
          line: 148,
          column: 12
        },
        end: {
          line: 155,
          column: 15
        }
      },
      "61": {
        start: {
          line: 157,
          column: 12
        },
        end: {
          line: 159,
          column: 15
        }
      },
      "62": {
        start: {
          line: 160,
          column: 12
        },
        end: {
          line: 160,
          column: 85
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 5,
            column: 9
          },
          end: {
            line: 5,
            column: 16
          }
        },
        loc: {
          start: {
            line: 5,
            column: 30
          },
          end: {
            line: 10,
            column: 1
          }
        },
        line: 5
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 12,
            column: 4
          },
          end: {
            line: 12,
            column: 5
          }
        },
        loc: {
          start: {
            line: 12,
            column: 15
          },
          end: {
            line: 14,
            column: 5
          }
        },
        line: 12
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 15,
            column: 4
          },
          end: {
            line: 15,
            column: 5
          }
        },
        loc: {
          start: {
            line: 15,
            column: 16
          },
          end: {
            line: 17,
            column: 5
          }
        },
        line: 15
      },
      "3": {
        name: "POST",
        decl: {
          start: {
            line: 45,
            column: 15
          },
          end: {
            line: 45,
            column: 19
          }
        },
        loc: {
          start: {
            line: 45,
            column: 29
          },
          end: {
            line: 83,
            column: 1
          }
        },
        line: 45
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 46,
            column: 50
          },
          end: {
            line: 46,
            column: 51
          }
        },
        loc: {
          start: {
            line: 46,
            column: 60
          },
          end: {
            line: 82,
            column: 5
          }
        },
        line: 46
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 58,
            column: 20
          },
          end: {
            line: 58,
            column: 21
          }
        },
        loc: {
          start: {
            line: 58,
            column: 27
          },
          end: {
            line: 58,
            column: 37
          }
        },
        line: 58
      },
      "6": {
        name: "handleMigrationRun",
        decl: {
          start: {
            line: 84,
            column: 15
          },
          end: {
            line: 84,
            column: 33
          }
        },
        loc: {
          start: {
            line: 84,
            column: 68
          },
          end: {
            line: 103,
            column: 1
          }
        },
        line: 84
      },
      "7": {
        name: "handleMigrationValidate",
        decl: {
          start: {
            line: 104,
            column: 15
          },
          end: {
            line: 104,
            column: 38
          }
        },
        loc: {
          start: {
            line: 104,
            column: 65
          },
          end: {
            line: 119,
            column: 1
          }
        },
        line: 104
      },
      "8": {
        name: "handleMigrationStatus",
        decl: {
          start: {
            line: 120,
            column: 15
          },
          end: {
            line: 120,
            column: 36
          }
        },
        loc: {
          start: {
            line: 120,
            column: 39
          },
          end: {
            line: 137,
            column: 1
          }
        },
        line: 120
      },
      "9": {
        name: "GET",
        decl: {
          start: {
            line: 138,
            column: 15
          },
          end: {
            line: 138,
            column: 18
          }
        },
        loc: {
          start: {
            line: 138,
            column: 28
          },
          end: {
            line: 163,
            column: 1
          }
        },
        line: 138
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 139,
            column: 50
          },
          end: {
            line: 139,
            column: 51
          }
        },
        loc: {
          start: {
            line: 139,
            column: 60
          },
          end: {
            line: 162,
            column: 5
          }
        },
        line: 139
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 50,
            column: 12
          },
          end: {
            line: 52,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 50,
            column: 12
          },
          end: {
            line: 52,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 50
      },
      "1": {
        loc: {
          start: {
            line: 59,
            column: 12
          },
          end: {
            line: 61,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 59,
            column: 12
          },
          end: {
            line: 61,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 59
      },
      "2": {
        loc: {
          start: {
            line: 66,
            column: 12
          },
          end: {
            line: 75,
            column: 13
          }
        },
        type: "switch",
        locations: [{
          start: {
            line: 67,
            column: 16
          },
          end: {
            line: 68,
            column: 86
          }
        }, {
          start: {
            line: 69,
            column: 16
          },
          end: {
            line: 70,
            column: 83
          }
        }, {
          start: {
            line: 71,
            column: 16
          },
          end: {
            line: 72,
            column: 57
          }
        }, {
          start: {
            line: 73,
            column: 16
          },
          end: {
            line: 74,
            column: 86
          }
        }],
        line: 66
      },
      "3": {
        loc: {
          start: {
            line: 111,
            column: 21
          },
          end: {
            line: 111,
            column: 91
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 111,
            column: 40
          },
          end: {
            line: 111,
            column: 64
          }
        }, {
          start: {
            line: 111,
            column: 67
          },
          end: {
            line: 111,
            column: 91
          }
        }],
        line: 111
      },
      "4": {
        loc: {
          start: {
            line: 143,
            column: 12
          },
          end: {
            line: 145,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 143,
            column: 12
          },
          end: {
            line: 145,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 143
      },
      "5": {
        loc: {
          start: {
            line: 153,
            column: 28
          },
          end: {
            line: 153,
            column: 86
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 153,
            column: 50
          },
          end: {
            line: 153,
            column: 79
          }
        }, {
          start: {
            line: 153,
            column: 82
          },
          end: {
            line: 153,
            column: 86
          }
        }],
        line: 153
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0, 0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\migration\\route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server'\r\nimport { z } from 'zod'\r\nimport { runMigration, validateMigrationData, MigrationConfig } from '@/app/lib/migration'\r\nimport { getServerSession } from 'next-auth'\r\nimport { authOptions } from '@/app/lib/auth'\r\nimport { logger } from '@/app/lib/logger'\r\nimport { formatErrorResponse } from '@/app/lib/api-errors'\r\nimport { withRateLimit } from '@/app/lib/rate-limit'\r\n\r\n// Migration request schema\r\nconst MigrationRequestSchema = z.object({\r\n  action: z.enum(['run', 'validate', 'status']),\r\n  config: z.object({\r\n    batchSize: z.number().min(1).max(1000).optional(),\r\n    maxRetries: z.number().min(1).max(10).optional(),\r\n    retryDelay: z.number().min(100).max(10000).optional(),\r\n    validateData: z.boolean().optional(),\r\n    createBackup: z.boolean().optional(),\r\n    dryRun: z.boolean().optional(),\r\n  }).optional(),\r\n})\r\n\r\n// Migration status cache\r\nconst migrationStatusCache = new Map<string, any>()\r\n\r\nexport async function POST(request: NextRequest) {\r\n  return withRateLimit(request, async () => {\r\n    try {\r\n      // Check authentication and admin privileges\r\n      const session = await getServerSession(authOptions)\r\n      if (!session?.user) {\r\n        return formatErrorResponse('Unauthorized', 401)\r\n      }\r\n\r\n      // Only allow admin users to run migrations\r\n      const { data: user } = await fetch(`${process.env.NEXTAUTH_URL}/api/user/profile`, {\r\n        headers: { Authorization: `Bearer ${session.accessToken}` }\r\n      }).then(res => res.json())\r\n\r\n      if (!user?.is_admin) {\r\n        return formatErrorResponse('Admin privileges required', 403)\r\n      }\r\n\r\n      const body = await request.json()\r\n      const { action, config } = MigrationRequestSchema.parse(body)\r\n\r\n      const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\n      const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n\r\n      switch (action) {\r\n        case 'run':\r\n          return await handleMigrationRun(supabaseUrl, supabaseKey, config)\r\n        \r\n        case 'validate':\r\n          return await handleMigrationValidate(supabaseUrl, supabaseKey)\r\n        \r\n        case 'status':\r\n          return await handleMigrationStatus()\r\n        \r\n        default:\r\n          return formatErrorResponse('Invalid action', 400)\r\n      }\r\n\r\n    } catch (error) {\r\n      logger.error('Migration API error', { error })\r\n      return formatErrorResponse('Internal server error', 500)\r\n    }\r\n  })\r\n}\r\n\r\nasync function handleMigrationRun(\r\n  supabaseUrl: string, \r\n  supabaseKey: string, \r\n  config?: Partial<MigrationConfig>\r\n) {\r\n  try {\r\n    logger.info('Starting migration', { config })\r\n    \r\n    const status = await runMigration(supabaseUrl, supabaseKey, config)\r\n    \r\n    // Cache the migration status\r\n    migrationStatusCache.set(status.id, status)\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      data: status,\r\n      message: 'Migration started successfully'\r\n    })\r\n\r\n  } catch (error) {\r\n    logger.error('Migration run failed', { error })\r\n    return formatErrorResponse('Migration failed', 500, error.message)\r\n  }\r\n}\r\n\r\nasync function handleMigrationValidate(supabaseUrl: string, supabaseKey: string) {\r\n  try {\r\n    logger.info('Starting migration validation')\r\n    \r\n    const validation = await validateMigrationData(supabaseUrl, supabaseKey)\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      data: validation,\r\n      message: validation.valid ? 'Data validation passed' : 'Data validation failed'\r\n    })\r\n\r\n  } catch (error) {\r\n    logger.error('Migration validation failed', { error })\r\n    return formatErrorResponse('Validation failed', 500, error.message)\r\n  }\r\n}\r\n\r\nasync function handleMigrationStatus() {\r\n  try {\r\n    // Return all cached migration statuses\r\n    const statuses = Array.from(migrationStatusCache.values())\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        migrations: statuses,\r\n        count: statuses.length\r\n      }\r\n    })\r\n\r\n  } catch (error) {\r\n    logger.error('Migration status check failed', { error })\r\n    return formatErrorResponse('Status check failed', 500, error.message)\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  return withRateLimit(request, async () => {\r\n    try {\r\n      // Check authentication\r\n      const session = await getServerSession(authOptions)\r\n      if (!session?.user) {\r\n        return formatErrorResponse('Unauthorized', 401)\r\n      }\r\n\r\n      // Get migration status\r\n      const statuses = Array.from(migrationStatusCache.values())\r\n      \r\n      return NextResponse.json({\r\n        success: true,\r\n        data: {\r\n          migrations: statuses,\r\n          count: statuses.length,\r\n          latest: statuses.length > 0 ? statuses[statuses.length - 1] : null\r\n        }\r\n      })\r\n\r\n    } catch (error) {\r\n      logger.error('Migration status API error', { error })\r\n      return formatErrorResponse('Internal server error', 500)\r\n    }\r\n  })\r\n}\r\n"],
      names: ["GET", "POST", "MigrationRequestSchema", "z", "object", "action", "enum", "config", "batchSize", "number", "min", "max", "optional", "maxRetries", "retryDelay", "validateData", "boolean", "createBackup", "dryRun", "migrationStatusCache", "Map", "request", "withRateLimit", "session", "getServerSession", "authOptions", "user", "formatErrorResponse", "data", "fetch", "process", "env", "NEXTAUTH_URL", "headers", "Authorization", "accessToken", "then", "res", "json", "is_admin", "body", "parse", "supabaseUrl", "NEXT_PUBLIC_SUPABASE_URL", "supabaseKey", "SUPABASE_SERVICE_ROLE_KEY", "handleMigrationRun", "handleMigrationValidate", "handleMigrationStatus", "error", "logger", "info", "status", "runMigration", "set", "id", "NextResponse", "success", "message", "validation", "validateMigrationData", "valid", "statuses", "Array", "from", "values", "migrations", "count", "length", "latest"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "1335fb810663a2543630bee4876b912082390c8c"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_ixb893f5j = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_ixb893f5j();
cov_ixb893f5j().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_ixb893f5j().f[0]++;
  cov_ixb893f5j().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_ixb893f5j().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: Object.getOwnPropertyDescriptor(all, name).get
    });
  }
}
/* istanbul ignore next */
cov_ixb893f5j().s[3]++;
_export(exports, {
  get GET() {
    /* istanbul ignore next */
    cov_ixb893f5j().f[1]++;
    cov_ixb893f5j().s[4]++;
    return GET;
  },
  get POST() {
    /* istanbul ignore next */
    cov_ixb893f5j().f[2]++;
    cov_ixb893f5j().s[5]++;
    return POST;
  }
});
const _server =
/* istanbul ignore next */
(cov_ixb893f5j().s[6]++, require("next/server"));
const _zod =
/* istanbul ignore next */
(cov_ixb893f5j().s[7]++, require("zod"));
const _migration =
/* istanbul ignore next */
(cov_ixb893f5j().s[8]++, require("../../lib/migration"));
const _nextauth =
/* istanbul ignore next */
(cov_ixb893f5j().s[9]++, require("next-auth"));
const _auth =
/* istanbul ignore next */
(cov_ixb893f5j().s[10]++, require("../../lib/auth"));
const _logger =
/* istanbul ignore next */
(cov_ixb893f5j().s[11]++, require("../../lib/logger"));
const _apierrors =
/* istanbul ignore next */
(cov_ixb893f5j().s[12]++, require("../../lib/api-errors"));
const _ratelimit =
/* istanbul ignore next */
(cov_ixb893f5j().s[13]++, require("../../lib/rate-limit"));
// Migration request schema
const MigrationRequestSchema =
/* istanbul ignore next */
(cov_ixb893f5j().s[14]++, _zod.z.object({
  action: _zod.z.enum(['run', 'validate', 'status']),
  config: _zod.z.object({
    batchSize: _zod.z.number().min(1).max(1000).optional(),
    maxRetries: _zod.z.number().min(1).max(10).optional(),
    retryDelay: _zod.z.number().min(100).max(10000).optional(),
    validateData: _zod.z.boolean().optional(),
    createBackup: _zod.z.boolean().optional(),
    dryRun: _zod.z.boolean().optional()
  }).optional()
}));
// Migration status cache
const migrationStatusCache =
/* istanbul ignore next */
(cov_ixb893f5j().s[15]++, new Map());
async function POST(request) {
  /* istanbul ignore next */
  cov_ixb893f5j().f[3]++;
  cov_ixb893f5j().s[16]++;
  return (0, _ratelimit.withRateLimit)(request, async () => {
    /* istanbul ignore next */
    cov_ixb893f5j().f[4]++;
    cov_ixb893f5j().s[17]++;
    try {
      // Check authentication and admin privileges
      const session =
      /* istanbul ignore next */
      (cov_ixb893f5j().s[18]++, await (0, _nextauth.getServerSession)(_auth.authOptions));
      /* istanbul ignore next */
      cov_ixb893f5j().s[19]++;
      if (!session?.user) {
        /* istanbul ignore next */
        cov_ixb893f5j().b[0][0]++;
        cov_ixb893f5j().s[20]++;
        return (0, _apierrors.formatErrorResponse)('Unauthorized', 401);
      } else
      /* istanbul ignore next */
      {
        cov_ixb893f5j().b[0][1]++;
      }
      // Only allow admin users to run migrations
      const {
        data: user
      } =
      /* istanbul ignore next */
      (cov_ixb893f5j().s[21]++, await fetch(`${process.env.NEXTAUTH_URL}/api/user/profile`, {
        headers: {
          Authorization: `Bearer ${session.accessToken}`
        }
      }).then(res => {
        /* istanbul ignore next */
        cov_ixb893f5j().f[5]++;
        cov_ixb893f5j().s[22]++;
        return res.json();
      }));
      /* istanbul ignore next */
      cov_ixb893f5j().s[23]++;
      if (!user?.is_admin) {
        /* istanbul ignore next */
        cov_ixb893f5j().b[1][0]++;
        cov_ixb893f5j().s[24]++;
        return (0, _apierrors.formatErrorResponse)('Admin privileges required', 403);
      } else
      /* istanbul ignore next */
      {
        cov_ixb893f5j().b[1][1]++;
      }
      const body =
      /* istanbul ignore next */
      (cov_ixb893f5j().s[25]++, await request.json());
      const {
        action,
        config
      } =
      /* istanbul ignore next */
      (cov_ixb893f5j().s[26]++, MigrationRequestSchema.parse(body));
      const supabaseUrl =
      /* istanbul ignore next */
      (cov_ixb893f5j().s[27]++, process.env.NEXT_PUBLIC_SUPABASE_URL);
      const supabaseKey =
      /* istanbul ignore next */
      (cov_ixb893f5j().s[28]++, process.env.SUPABASE_SERVICE_ROLE_KEY);
      /* istanbul ignore next */
      cov_ixb893f5j().s[29]++;
      switch (action) {
        case 'run':
          /* istanbul ignore next */
          cov_ixb893f5j().b[2][0]++;
          cov_ixb893f5j().s[30]++;
          return await handleMigrationRun(supabaseUrl, supabaseKey, config);
        case 'validate':
          /* istanbul ignore next */
          cov_ixb893f5j().b[2][1]++;
          cov_ixb893f5j().s[31]++;
          return await handleMigrationValidate(supabaseUrl, supabaseKey);
        case 'status':
          /* istanbul ignore next */
          cov_ixb893f5j().b[2][2]++;
          cov_ixb893f5j().s[32]++;
          return await handleMigrationStatus();
        default:
          /* istanbul ignore next */
          cov_ixb893f5j().b[2][3]++;
          cov_ixb893f5j().s[33]++;
          return (0, _apierrors.formatErrorResponse)('Invalid action', 400);
      }
    } catch (error) {
      /* istanbul ignore next */
      cov_ixb893f5j().s[34]++;
      _logger.logger.error('Migration API error', {
        error
      });
      /* istanbul ignore next */
      cov_ixb893f5j().s[35]++;
      return (0, _apierrors.formatErrorResponse)('Internal server error', 500);
    }
  });
}
async function handleMigrationRun(supabaseUrl, supabaseKey, config) {
  /* istanbul ignore next */
  cov_ixb893f5j().f[6]++;
  cov_ixb893f5j().s[36]++;
  try {
    /* istanbul ignore next */
    cov_ixb893f5j().s[37]++;
    _logger.logger.info('Starting migration', {
      config
    });
    const status =
    /* istanbul ignore next */
    (cov_ixb893f5j().s[38]++, await (0, _migration.runMigration)(supabaseUrl, supabaseKey, config));
    // Cache the migration status
    /* istanbul ignore next */
    cov_ixb893f5j().s[39]++;
    migrationStatusCache.set(status.id, status);
    /* istanbul ignore next */
    cov_ixb893f5j().s[40]++;
    return _server.NextResponse.json({
      success: true,
      data: status,
      message: 'Migration started successfully'
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_ixb893f5j().s[41]++;
    _logger.logger.error('Migration run failed', {
      error
    });
    /* istanbul ignore next */
    cov_ixb893f5j().s[42]++;
    return (0, _apierrors.formatErrorResponse)('Migration failed', 500, error.message);
  }
}
async function handleMigrationValidate(supabaseUrl, supabaseKey) {
  /* istanbul ignore next */
  cov_ixb893f5j().f[7]++;
  cov_ixb893f5j().s[43]++;
  try {
    /* istanbul ignore next */
    cov_ixb893f5j().s[44]++;
    _logger.logger.info('Starting migration validation');
    const validation =
    /* istanbul ignore next */
    (cov_ixb893f5j().s[45]++, await (0, _migration.validateMigrationData)(supabaseUrl, supabaseKey));
    /* istanbul ignore next */
    cov_ixb893f5j().s[46]++;
    return _server.NextResponse.json({
      success: true,
      data: validation,
      message: validation.valid ?
      /* istanbul ignore next */
      (cov_ixb893f5j().b[3][0]++, 'Data validation passed') :
      /* istanbul ignore next */
      (cov_ixb893f5j().b[3][1]++, 'Data validation failed')
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_ixb893f5j().s[47]++;
    _logger.logger.error('Migration validation failed', {
      error
    });
    /* istanbul ignore next */
    cov_ixb893f5j().s[48]++;
    return (0, _apierrors.formatErrorResponse)('Validation failed', 500, error.message);
  }
}
async function handleMigrationStatus() {
  /* istanbul ignore next */
  cov_ixb893f5j().f[8]++;
  cov_ixb893f5j().s[49]++;
  try {
    // Return all cached migration statuses
    const statuses =
    /* istanbul ignore next */
    (cov_ixb893f5j().s[50]++, Array.from(migrationStatusCache.values()));
    /* istanbul ignore next */
    cov_ixb893f5j().s[51]++;
    return _server.NextResponse.json({
      success: true,
      data: {
        migrations: statuses,
        count: statuses.length
      }
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_ixb893f5j().s[52]++;
    _logger.logger.error('Migration status check failed', {
      error
    });
    /* istanbul ignore next */
    cov_ixb893f5j().s[53]++;
    return (0, _apierrors.formatErrorResponse)('Status check failed', 500, error.message);
  }
}
async function GET(request) {
  /* istanbul ignore next */
  cov_ixb893f5j().f[9]++;
  cov_ixb893f5j().s[54]++;
  return (0, _ratelimit.withRateLimit)(request, async () => {
    /* istanbul ignore next */
    cov_ixb893f5j().f[10]++;
    cov_ixb893f5j().s[55]++;
    try {
      // Check authentication
      const session =
      /* istanbul ignore next */
      (cov_ixb893f5j().s[56]++, await (0, _nextauth.getServerSession)(_auth.authOptions));
      /* istanbul ignore next */
      cov_ixb893f5j().s[57]++;
      if (!session?.user) {
        /* istanbul ignore next */
        cov_ixb893f5j().b[4][0]++;
        cov_ixb893f5j().s[58]++;
        return (0, _apierrors.formatErrorResponse)('Unauthorized', 401);
      } else
      /* istanbul ignore next */
      {
        cov_ixb893f5j().b[4][1]++;
      }
      // Get migration status
      const statuses =
      /* istanbul ignore next */
      (cov_ixb893f5j().s[59]++, Array.from(migrationStatusCache.values()));
      /* istanbul ignore next */
      cov_ixb893f5j().s[60]++;
      return _server.NextResponse.json({
        success: true,
        data: {
          migrations: statuses,
          count: statuses.length,
          latest: statuses.length > 0 ?
          /* istanbul ignore next */
          (cov_ixb893f5j().b[5][0]++, statuses[statuses.length - 1]) :
          /* istanbul ignore next */
          (cov_ixb893f5j().b[5][1]++, null)
        }
      });
    } catch (error) {
      /* istanbul ignore next */
      cov_ixb893f5j().s[61]++;
      _logger.logger.error('Migration status API error', {
        error
      });
      /* istanbul ignore next */
      cov_ixb893f5j().s[62]++;
      return (0, _apierrors.formatErrorResponse)('Internal server error', 500);
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHRVQiLCJjb3ZfaXhiODkzZjVqIiwiZiIsInMiLCJQT1NUIiwiTWlncmF0aW9uUmVxdWVzdFNjaGVtYSIsIl96b2QiLCJ6Iiwib2JqZWN0IiwiYWN0aW9uIiwiZW51bSIsImNvbmZpZyIsImJhdGNoU2l6ZSIsIm51bWJlciIsIm1pbiIsIm1heCIsIm9wdGlvbmFsIiwibWF4UmV0cmllcyIsInJldHJ5RGVsYXkiLCJ2YWxpZGF0ZURhdGEiLCJib29sZWFuIiwiY3JlYXRlQmFja3VwIiwiZHJ5UnVuIiwibWlncmF0aW9uU3RhdHVzQ2FjaGUiLCJNYXAiLCJyZXF1ZXN0IiwiX3JhdGVsaW1pdCIsIndpdGhSYXRlTGltaXQiLCJzZXNzaW9uIiwiX25leHRhdXRoIiwiZ2V0U2VydmVyU2Vzc2lvbiIsIl9hdXRoIiwiYXV0aE9wdGlvbnMiLCJ1c2VyIiwiYiIsIl9hcGllcnJvcnMiLCJmb3JtYXRFcnJvclJlc3BvbnNlIiwiZGF0YSIsImZldGNoIiwicHJvY2VzcyIsImVudiIsIk5FWFRBVVRIX1VSTCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYWNjZXNzVG9rZW4iLCJ0aGVuIiwicmVzIiwianNvbiIsImlzX2FkbWluIiwiYm9keSIsInBhcnNlIiwic3VwYWJhc2VVcmwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJoYW5kbGVNaWdyYXRpb25SdW4iLCJoYW5kbGVNaWdyYXRpb25WYWxpZGF0ZSIsImhhbmRsZU1pZ3JhdGlvblN0YXR1cyIsImVycm9yIiwiX2xvZ2dlciIsImxvZ2dlciIsImluZm8iLCJzdGF0dXMiLCJfbWlncmF0aW9uIiwicnVuTWlncmF0aW9uIiwic2V0IiwiaWQiLCJfc2VydmVyIiwiTmV4dFJlc3BvbnNlIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJ2YWxpZGF0aW9uIiwidmFsaWRhdGVNaWdyYXRpb25EYXRhIiwidmFsaWQiLCJzdGF0dXNlcyIsIkFycmF5IiwiZnJvbSIsInZhbHVlcyIsIm1pZ3JhdGlvbnMiLCJjb3VudCIsImxlbmd0aCIsImxhdGVzdCJdLCJzb3VyY2VzIjpbIlI6XFxBcHBzXFxCcmllZmx5X0Nsb3VkXFxicmllZmx5LWNsb3VkLW5leHRqc1xcc3JjXFxhcHBcXGFwaVxcbWlncmF0aW9uXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXHJcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnXHJcbmltcG9ydCB7IHJ1bk1pZ3JhdGlvbiwgdmFsaWRhdGVNaWdyYXRpb25EYXRhLCBNaWdyYXRpb25Db25maWcgfSBmcm9tICdAL2FwcC9saWIvbWlncmF0aW9uJ1xyXG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoJ1xyXG5pbXBvcnQgeyBhdXRoT3B0aW9ucyB9IGZyb20gJ0AvYXBwL2xpYi9hdXRoJ1xyXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL2FwcC9saWIvbG9nZ2VyJ1xyXG5pbXBvcnQgeyBmb3JtYXRFcnJvclJlc3BvbnNlIH0gZnJvbSAnQC9hcHAvbGliL2FwaS1lcnJvcnMnXHJcbmltcG9ydCB7IHdpdGhSYXRlTGltaXQgfSBmcm9tICdAL2FwcC9saWIvcmF0ZS1saW1pdCdcclxuXHJcbi8vIE1pZ3JhdGlvbiByZXF1ZXN0IHNjaGVtYVxyXG5jb25zdCBNaWdyYXRpb25SZXF1ZXN0U2NoZW1hID0gei5vYmplY3Qoe1xyXG4gIGFjdGlvbjogei5lbnVtKFsncnVuJywgJ3ZhbGlkYXRlJywgJ3N0YXR1cyddKSxcclxuICBjb25maWc6IHoub2JqZWN0KHtcclxuICAgIGJhdGNoU2l6ZTogei5udW1iZXIoKS5taW4oMSkubWF4KDEwMDApLm9wdGlvbmFsKCksXHJcbiAgICBtYXhSZXRyaWVzOiB6Lm51bWJlcigpLm1pbigxKS5tYXgoMTApLm9wdGlvbmFsKCksXHJcbiAgICByZXRyeURlbGF5OiB6Lm51bWJlcigpLm1pbigxMDApLm1heCgxMDAwMCkub3B0aW9uYWwoKSxcclxuICAgIHZhbGlkYXRlRGF0YTogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcclxuICAgIGNyZWF0ZUJhY2t1cDogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcclxuICAgIGRyeVJ1bjogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcclxuICB9KS5vcHRpb25hbCgpLFxyXG59KVxyXG5cclxuLy8gTWlncmF0aW9uIHN0YXR1cyBjYWNoZVxyXG5jb25zdCBtaWdyYXRpb25TdGF0dXNDYWNoZSA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KClcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgcmV0dXJuIHdpdGhSYXRlTGltaXQocmVxdWVzdCwgYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ2hlY2sgYXV0aGVudGljYXRpb24gYW5kIGFkbWluIHByaXZpbGVnZXNcclxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlcnZlclNlc3Npb24oYXV0aE9wdGlvbnMpXHJcbiAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xyXG4gICAgICAgIHJldHVybiBmb3JtYXRFcnJvclJlc3BvbnNlKCdVbmF1dGhvcml6ZWQnLCA0MDEpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIE9ubHkgYWxsb3cgYWRtaW4gdXNlcnMgdG8gcnVuIG1pZ3JhdGlvbnNcclxuICAgICAgY29uc3QgeyBkYXRhOiB1c2VyIH0gPSBhd2FpdCBmZXRjaChgJHtwcm9jZXNzLmVudi5ORVhUQVVUSF9VUkx9L2FwaS91c2VyL3Byb2ZpbGVgLCB7XHJcbiAgICAgICAgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7c2Vzc2lvbi5hY2Nlc3NUb2tlbn1gIH1cclxuICAgICAgfSkudGhlbihyZXMgPT4gcmVzLmpzb24oKSlcclxuXHJcbiAgICAgIGlmICghdXNlcj8uaXNfYWRtaW4pIHtcclxuICAgICAgICByZXR1cm4gZm9ybWF0RXJyb3JSZXNwb25zZSgnQWRtaW4gcHJpdmlsZWdlcyByZXF1aXJlZCcsIDQwMylcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXHJcbiAgICAgIGNvbnN0IHsgYWN0aW9uLCBjb25maWcgfSA9IE1pZ3JhdGlvblJlcXVlc3RTY2hlbWEucGFyc2UoYm9keSlcclxuXHJcbiAgICAgIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIVxyXG4gICAgICBjb25zdCBzdXBhYmFzZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkhXHJcblxyXG4gICAgICBzd2l0Y2ggKGFjdGlvbikge1xyXG4gICAgICAgIGNhc2UgJ3J1bic6XHJcbiAgICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlTWlncmF0aW9uUnVuKHN1cGFiYXNlVXJsLCBzdXBhYmFzZUtleSwgY29uZmlnKVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNhc2UgJ3ZhbGlkYXRlJzpcclxuICAgICAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVNaWdyYXRpb25WYWxpZGF0ZShzdXBhYmFzZVVybCwgc3VwYWJhc2VLZXkpXHJcbiAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnc3RhdHVzJzpcclxuICAgICAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVNaWdyYXRpb25TdGF0dXMoKVxyXG4gICAgICAgIFxyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICByZXR1cm4gZm9ybWF0RXJyb3JSZXNwb25zZSgnSW52YWxpZCBhY3Rpb24nLCA0MDApXHJcbiAgICAgIH1cclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ01pZ3JhdGlvbiBBUEkgZXJyb3InLCB7IGVycm9yIH0pXHJcbiAgICAgIHJldHVybiBmb3JtYXRFcnJvclJlc3BvbnNlKCdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLCA1MDApXHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlTWlncmF0aW9uUnVuKFxyXG4gIHN1cGFiYXNlVXJsOiBzdHJpbmcsIFxyXG4gIHN1cGFiYXNlS2V5OiBzdHJpbmcsIFxyXG4gIGNvbmZpZz86IFBhcnRpYWw8TWlncmF0aW9uQ29uZmlnPlxyXG4pIHtcclxuICB0cnkge1xyXG4gICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIG1pZ3JhdGlvbicsIHsgY29uZmlnIH0pXHJcbiAgICBcclxuICAgIGNvbnN0IHN0YXR1cyA9IGF3YWl0IHJ1bk1pZ3JhdGlvbihzdXBhYmFzZVVybCwgc3VwYWJhc2VLZXksIGNvbmZpZylcclxuICAgIFxyXG4gICAgLy8gQ2FjaGUgdGhlIG1pZ3JhdGlvbiBzdGF0dXNcclxuICAgIG1pZ3JhdGlvblN0YXR1c0NhY2hlLnNldChzdGF0dXMuaWQsIHN0YXR1cylcclxuICAgIFxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YTogc3RhdHVzLFxyXG4gICAgICBtZXNzYWdlOiAnTWlncmF0aW9uIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5J1xyXG4gICAgfSlcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ2dlci5lcnJvcignTWlncmF0aW9uIHJ1biBmYWlsZWQnLCB7IGVycm9yIH0pXHJcbiAgICByZXR1cm4gZm9ybWF0RXJyb3JSZXNwb25zZSgnTWlncmF0aW9uIGZhaWxlZCcsIDUwMCwgZXJyb3IubWVzc2FnZSlcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZU1pZ3JhdGlvblZhbGlkYXRlKHN1cGFiYXNlVXJsOiBzdHJpbmcsIHN1cGFiYXNlS2V5OiBzdHJpbmcpIHtcclxuICB0cnkge1xyXG4gICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIG1pZ3JhdGlvbiB2YWxpZGF0aW9uJylcclxuICAgIFxyXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHZhbGlkYXRlTWlncmF0aW9uRGF0YShzdXBhYmFzZVVybCwgc3VwYWJhc2VLZXkpXHJcbiAgICBcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIGRhdGE6IHZhbGlkYXRpb24sXHJcbiAgICAgIG1lc3NhZ2U6IHZhbGlkYXRpb24udmFsaWQgPyAnRGF0YSB2YWxpZGF0aW9uIHBhc3NlZCcgOiAnRGF0YSB2YWxpZGF0aW9uIGZhaWxlZCdcclxuICAgIH0pXHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXIuZXJyb3IoJ01pZ3JhdGlvbiB2YWxpZGF0aW9uIGZhaWxlZCcsIHsgZXJyb3IgfSlcclxuICAgIHJldHVybiBmb3JtYXRFcnJvclJlc3BvbnNlKCdWYWxpZGF0aW9uIGZhaWxlZCcsIDUwMCwgZXJyb3IubWVzc2FnZSlcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZU1pZ3JhdGlvblN0YXR1cygpIHtcclxuICB0cnkge1xyXG4gICAgLy8gUmV0dXJuIGFsbCBjYWNoZWQgbWlncmF0aW9uIHN0YXR1c2VzXHJcbiAgICBjb25zdCBzdGF0dXNlcyA9IEFycmF5LmZyb20obWlncmF0aW9uU3RhdHVzQ2FjaGUudmFsdWVzKCkpXHJcbiAgICBcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBtaWdyYXRpb25zOiBzdGF0dXNlcyxcclxuICAgICAgICBjb3VudDogc3RhdHVzZXMubGVuZ3RoXHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXIuZXJyb3IoJ01pZ3JhdGlvbiBzdGF0dXMgY2hlY2sgZmFpbGVkJywgeyBlcnJvciB9KVxyXG4gICAgcmV0dXJuIGZvcm1hdEVycm9yUmVzcG9uc2UoJ1N0YXR1cyBjaGVjayBmYWlsZWQnLCA1MDAsIGVycm9yLm1lc3NhZ2UpXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgcmV0dXJuIHdpdGhSYXRlTGltaXQocmVxdWVzdCwgYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ2hlY2sgYXV0aGVudGljYXRpb25cclxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlcnZlclNlc3Npb24oYXV0aE9wdGlvbnMpXHJcbiAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xyXG4gICAgICAgIHJldHVybiBmb3JtYXRFcnJvclJlc3BvbnNlKCdVbmF1dGhvcml6ZWQnLCA0MDEpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCBtaWdyYXRpb24gc3RhdHVzXHJcbiAgICAgIGNvbnN0IHN0YXR1c2VzID0gQXJyYXkuZnJvbShtaWdyYXRpb25TdGF0dXNDYWNoZS52YWx1ZXMoKSlcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBtaWdyYXRpb25zOiBzdGF0dXNlcyxcclxuICAgICAgICAgIGNvdW50OiBzdGF0dXNlcy5sZW5ndGgsXHJcbiAgICAgICAgICBsYXRlc3Q6IHN0YXR1c2VzLmxlbmd0aCA+IDAgPyBzdGF0dXNlc1tzdGF0dXNlcy5sZW5ndGggLSAxXSA6IG51bGxcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdNaWdyYXRpb24gc3RhdHVzIEFQSSBlcnJvcicsIHsgZXJyb3IgfSlcclxuICAgICAgcmV0dXJuIGZvcm1hdEVycm9yUmVzcG9uc2UoJ0ludGVybmFsIHNlcnZlciBlcnJvcicsIDUwMClcclxuICAgIH1cclxuICB9KVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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