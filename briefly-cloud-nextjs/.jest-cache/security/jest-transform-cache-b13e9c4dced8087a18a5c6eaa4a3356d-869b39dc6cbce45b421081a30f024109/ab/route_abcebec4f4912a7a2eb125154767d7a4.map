{"version":3,"names":["POST","batchChunkingSchema","cov_2mcobfwqyt","s","_zod","z","object","file_ids","array","string","min","max","strategy","enum","optional","default","maxChunkSize","number","minChunkSize","overlap","preserveStructure","boolean","respectBoundaries","saveToDatabase","forceReprocess","batchChunkingHandler","request","context","f","user","b","_apiutils","ApiResponse","unauthorized","body","json","validation","safeParse","success","badRequest","data","supabase","_supabase","supabaseAdmin","files","error","filesError","from","select","eq","id","in","console","internalError","length","notFound","results","processed","skipped","failed","summary","total_requested","total_found","total_processed","total_skipped","total_failed","total_chunks_created","total_processing_time","chunker","_documentchunker","DocumentChunker","file","startTime","Date","now","existingChunks","getDocumentChunks","stats","getChunkingStats","push","file_id","file_name","name","from_cache","chunk_count","processing_time","text","source","path","fileData","downloadError","storage","download","buffer","Buffer","arrayBuffer","extractionResult","_documentextractor","extractTextFromBuffer","mime_type","reason","trim","chunks","createChunks","storeDocumentChunks","update","processing_status","metadata","chunking_strategy","max_chunk_size","min_chunk_size","preserve_structure","respect_boundaries","processed_at","toISOString","updated_at","dbError","processingTime","text_length","Error","message","_logger","logApiUsage","requested_count","processed_count","skipped_count","failed_count","save_to_database","_apimiddleware","createProtectedApiHandler","rateLimit","_ratelimit","rateLimitConfigs","embedding","maxRequests","logging","enabled","includeBody"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\chunks\\batch\\route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createProtectedApiHandler, ApiContext } from '@/app/lib/api-middleware'\r\nimport { ApiResponse } from '@/app/lib/api-utils'\r\nimport { rateLimitConfigs } from '@/app/lib/rate-limit'\r\nimport { supabaseAdmin } from '@/app/lib/supabase'\r\nimport { logApiUsage } from '@/app/lib/logger'\r\nimport { \r\n  DocumentChunker, \r\n  storeDocumentChunks, \r\n  getDocumentChunks,\r\n  getChunkingStats\r\n} from '@/app/lib/document-chunker'\r\nimport { extractTextFromBuffer } from '@/app/lib/document-extractor'\r\nimport { z } from 'zod'\r\n\r\n// Validation schema\r\nconst batchChunkingSchema = z.object({\r\n  file_ids: z.array(z.string()).min(1).max(10), // Limit to 10 files at once\r\n  strategy: z.enum(['paragraph', 'sentence', 'fixed', 'semantic', 'sliding']).optional().default('paragraph'),\r\n  maxChunkSize: z.number().min(100).max(5000).optional().default(1000),\r\n  minChunkSize: z.number().min(50).max(2000).optional(),\r\n  overlap: z.number().min(0).max(1000).optional(),\r\n  preserveStructure: z.boolean().optional(),\r\n  respectBoundaries: z.boolean().optional(),\r\n  saveToDatabase: z.boolean().optional().default(true),\r\n  forceReprocess: z.boolean().optional().default(false),\r\n})\r\n\r\n// POST /api/chunks/batch - Create chunks for multiple files\r\nasync function batchChunkingHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const body = await request.json()\r\n    const validation = batchChunkingSchema.safeParse(body)\r\n    \r\n    if (!validation.success) {\r\n      return ApiResponse.badRequest('Invalid request data')\r\n    }\r\n    \r\n    const {\r\n      file_ids,\r\n      strategy,\r\n      maxChunkSize,\r\n      minChunkSize,\r\n      overlap,\r\n      preserveStructure,\r\n      respectBoundaries,\r\n      saveToDatabase,\r\n      forceReprocess,\r\n    } = validation.data\r\n    \r\n    const supabase = supabaseAdmin\r\n    \r\n    // Get files metadata\r\n    const { data: files, error: filesError } = await supabase\r\n      .from('file_metadata')\r\n      .select('*')\r\n      .eq('user_id', user.id)\r\n      .in('id', file_ids)\r\n    \r\n    if (filesError) {\r\n      console.error('Files fetch error:', filesError)\r\n      return ApiResponse.internalError('Failed to fetch files')\r\n    }\r\n    \r\n    if (!files || files.length === 0) {\r\n      return ApiResponse.notFound('No files found')\r\n    }\r\n    \r\n    const results = {\r\n      processed: [] as any[],\r\n      skipped: [] as any[],\r\n      failed: [] as any[],\r\n      summary: {\r\n        total_requested: file_ids.length,\r\n        total_found: files.length,\r\n        total_processed: 0,\r\n        total_skipped: 0,\r\n        total_failed: 0,\r\n        total_chunks_created: 0,\r\n        total_processing_time: 0,\r\n      },\r\n    }\r\n    \r\n    // Create chunker with configuration\r\n    const chunker = new DocumentChunker({\r\n      strategy,\r\n      maxChunkSize,\r\n      minChunkSize,\r\n      overlap,\r\n      preserveStructure,\r\n      respectBoundaries,\r\n    })\r\n    \r\n    // Process each file\r\n    for (const file of files) {\r\n      const startTime = Date.now()\r\n      \r\n      try {\r\n        // Check if already processed and not forcing reprocess\r\n        if (file.processed && !forceReprocess) {\r\n          const existingChunks = await getDocumentChunks(file.id, user.id)\r\n          \r\n          if (existingChunks.length > 0) {\r\n            const stats = getChunkingStats(existingChunks)\r\n            \r\n            results.processed.push({\r\n              file_id: file.id,\r\n              file_name: file.name,\r\n              from_cache: true,\r\n              chunk_count: existingChunks.length,\r\n              processing_time: 0,\r\n              stats,\r\n            })\r\n            \r\n            results.summary.total_chunks_created += existingChunks.length\r\n            continue\r\n          }\r\n        }\r\n        \r\n        // Extract text from file\r\n        let text: string\r\n        \r\n        if (file.source === 'upload' && file.path) {\r\n          const { data: fileData, error: downloadError } = await supabase.storage\r\n            .from('documents')\r\n            .download(file.path)\r\n          \r\n          if (downloadError || !fileData) {\r\n            results.failed.push({\r\n              file_id: file.id,\r\n              file_name: file.name,\r\n              error: 'Failed to download file',\r\n            })\r\n            continue\r\n          }\r\n          \r\n          const buffer = Buffer.from(await fileData.arrayBuffer())\r\n          const extractionResult = await extractTextFromBuffer(buffer, file.mime_type, file.name)\r\n          text = extractionResult.text\r\n        } else {\r\n          results.skipped.push({\r\n            file_id: file.id,\r\n            file_name: file.name,\r\n            reason: 'Cloud storage files not yet supported for batch chunking',\r\n          })\r\n          continue\r\n        }\r\n        \r\n        if (!text.trim()) {\r\n          results.skipped.push({\r\n            file_id: file.id,\r\n            file_name: file.name,\r\n            reason: 'No text content found in file',\r\n          })\r\n          continue\r\n        }\r\n        \r\n        // Create chunks\r\n        const chunks = chunker.createChunks(text, file.id, file.name, file.mime_type, user.id)\r\n        \r\n        // Store in database if requested\r\n        if (saveToDatabase) {\r\n          try {\r\n            await storeDocumentChunks(chunks, user.id, file.id)\r\n            \r\n            // Update file metadata\r\n            await supabase\r\n              .from('file_metadata')\r\n              .update({\r\n                processed: true,\r\n                processing_status: 'completed',\r\n                metadata: {\r\n                  ...file.metadata,\r\n                  chunk_count: chunks.length,\r\n                  chunking_strategy: strategy,\r\n                  max_chunk_size: maxChunkSize,\r\n                  min_chunk_size: minChunkSize,\r\n                  overlap,\r\n                  preserve_structure: preserveStructure,\r\n                  respect_boundaries: respectBoundaries,\r\n                  processed_at: new Date().toISOString(),\r\n                },\r\n                updated_at: new Date().toISOString(),\r\n              })\r\n              .eq('id', file.id)\r\n              .eq('user_id', user.id)\r\n            \r\n          } catch (dbError) {\r\n            console.error(`Database save error for file ${file.id}:`, dbError)\r\n            // Continue without failing the chunking\r\n          }\r\n        }\r\n        \r\n        const processingTime = Date.now() - startTime\r\n        const stats = getChunkingStats(chunks)\r\n        \r\n        results.processed.push({\r\n          file_id: file.id,\r\n          file_name: file.name,\r\n          from_cache: false,\r\n          chunk_count: chunks.length,\r\n          processing_time: processingTime,\r\n          text_length: text.length,\r\n          stats,\r\n        })\r\n        \r\n        results.summary.total_chunks_created += chunks.length\r\n        results.summary.total_processing_time += processingTime\r\n        \r\n      } catch (error) {\r\n        console.error(`Error processing file ${file.id}:`, error)\r\n        results.failed.push({\r\n          file_id: file.id,\r\n          file_name: file.name,\r\n          error: error instanceof Error ? error.message : 'Unknown error',\r\n        })\r\n      }\r\n    }\r\n    \r\n    // Update summary\r\n    results.summary.total_processed = results.processed.length\r\n    results.summary.total_skipped = results.skipped.length\r\n    results.summary.total_failed = results.failed.length\r\n    \r\n    // Log usage\r\n    logApiUsage(user.id, '/api/chunks/batch', 'batch_chunking', {\r\n      requested_count: file_ids.length,\r\n      processed_count: results.summary.total_processed,\r\n      skipped_count: results.summary.total_skipped,\r\n      failed_count: results.summary.total_failed,\r\n      total_chunks_created: results.summary.total_chunks_created,\r\n      total_processing_time: results.summary.total_processing_time,\r\n      strategy,\r\n      max_chunk_size: maxChunkSize,\r\n      save_to_database: saveToDatabase,\r\n    })\r\n    \r\n    return ApiResponse.success(results, \r\n      `Batch chunking completed: ${results.summary.total_processed} processed, ${results.summary.total_skipped} skipped, ${results.summary.total_failed} failed`\r\n    )\r\n    \r\n  } catch (error) {\r\n    console.error('Batch chunking handler error:', error)\r\n    return ApiResponse.internalError('Failed to process batch chunking')\r\n  }\r\n}\r\n\r\n// Export handler with middleware\r\nexport const POST = createProtectedApiHandler(batchChunkingHandler, {\r\n  rateLimit: {\r\n    ...rateLimitConfigs.embedding, // Use embedding rate limits (more restrictive)\r\n    maxRequests: 3, // Very restrictive for batch operations\r\n  },\r\n  logging: {\r\n    enabled: true,\r\n    includeBody: true,\r\n  },\r\n})"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}