{"version":3,"names":["DELETE","cov_q57dc2sqn","f","s","GET","PUT","getProfileHandler","request","context","user","b","_apiutils","ApiResponse","unauthorized","supabase","_supabase","supabaseAdmin","data","userProfile","error","from","select","eq","id","single","console","internalError","usageStats","chat_messages","used","chat_messages_count","limit","chat_messages_limit","percentage","Math","round","documents","documents_uploaded","documents_limit","api_calls","api_calls_count","api_calls_limit","storage","storage_used_bytes","storage_limit_bytes","_logger","logApiUsage","success","profile","usage_stats","updateProfileHandler","validatedData","body","badRequest","updateData","updatedProfile","update","full_name","preferences","updated_at","Date","toISOString","fields_updated","Object","keys","deleteProfileHandler","Promise","all","delete","deleteError","authDeleteError","auth","admin","deleteUser","_apimiddleware","createProtectedApiHandler","rateLimit","_ratelimit","rateLimitConfigs","general","logging","enabled","includeBody","maxRequests","validation","_validations","userProfileSchema","strict"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\user\\profile\\route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createProtectedApiHandler, ApiContext } from '@/app/lib/api-middleware'\r\nimport { ApiResponse } from '@/app/lib/api-utils'\r\nimport { rateLimitConfigs } from '@/app/lib/rate-limit'\r\nimport { userProfileSchema } from '@/app/lib/validations'\r\nimport { supabaseAdmin } from '@/app/lib/supabase'\r\nimport { logApiUsage } from '@/app/lib/logger'\r\n\r\n// GET /api/user/profile - Get user profile\r\nasync function getProfileHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const supabase = supabaseAdmin\r\n    \r\n    // Get full user profile with usage statistics\r\n    const { data: userProfile, error } = await supabase\r\n      .from('users')\r\n      .select(`\r\n        id,\r\n        email,\r\n        full_name,\r\n        subscription_tier,\r\n        subscription_status,\r\n        chat_messages_count,\r\n        chat_messages_limit,\r\n        documents_uploaded,\r\n        documents_limit,\r\n        api_calls_count,\r\n        api_calls_limit,\r\n        storage_used_bytes,\r\n        storage_limit_bytes,\r\n        preferences,\r\n        features_enabled,\r\n        permissions,\r\n        created_at,\r\n        updated_at,\r\n        usage_reset_date,\r\n        trial_end_date\r\n      `)\r\n      .eq('id', user.id)\r\n      .single()\r\n    \r\n    if (error) {\r\n      console.error('Profile fetch error:', error)\r\n      return ApiResponse.internalError('Failed to fetch user profile')\r\n    }\r\n    \r\n    // Calculate usage percentages\r\n    const usageStats = {\r\n      chat_messages: {\r\n        used: userProfile.chat_messages_count || 0,\r\n        limit: userProfile.chat_messages_limit || 0,\r\n        percentage: Math.round(((userProfile.chat_messages_count || 0) / (userProfile.chat_messages_limit || 1)) * 100)\r\n      },\r\n      documents: {\r\n        used: userProfile.documents_uploaded || 0,\r\n        limit: userProfile.documents_limit || 0,\r\n        percentage: Math.round(((userProfile.documents_uploaded || 0) / (userProfile.documents_limit || 1)) * 100)\r\n      },\r\n      api_calls: {\r\n        used: userProfile.api_calls_count || 0,\r\n        limit: userProfile.api_calls_limit || 0,\r\n        percentage: Math.round(((userProfile.api_calls_count || 0) / (userProfile.api_calls_limit || 1)) * 100)\r\n      },\r\n      storage: {\r\n        used: userProfile.storage_used_bytes || 0,\r\n        limit: userProfile.storage_limit_bytes || 0,\r\n        percentage: Math.round(((userProfile.storage_used_bytes || 0) / (userProfile.storage_limit_bytes || 1)) * 100)\r\n      }\r\n    }\r\n    \r\n    // Log usage\r\n    logApiUsage(user.id, '/api/user/profile', 'profile_view')\r\n    \r\n    return ApiResponse.success({\r\n      profile: userProfile,\r\n      usage_stats: usageStats,\r\n    })\r\n    \r\n  } catch (error) {\r\n    console.error('Profile handler error:', error)\r\n    return ApiResponse.internalError('Failed to process profile request')\r\n  }\r\n}\r\n\r\n// PUT /api/user/profile - Update user profile\r\nasync function updateProfileHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user, validatedData } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  if (!validatedData?.body) {\r\n    return ApiResponse.badRequest('Invalid request body')\r\n  }\r\n  \r\n  try {\r\n    const supabase = supabaseAdmin\r\n    \r\n    const updateData = validatedData.body\r\n    \r\n    // Update user profile\r\n    const { data: updatedProfile, error } = await supabase\r\n      .from('users')\r\n      .update({\r\n        full_name: updateData.full_name,\r\n        preferences: updateData.preferences,\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .eq('id', user.id)\r\n      .select()\r\n      .single()\r\n    \r\n    if (error) {\r\n      console.error('Profile update error:', error)\r\n      return ApiResponse.internalError('Failed to update profile')\r\n    }\r\n    \r\n    // Log usage\r\n    logApiUsage(user.id, '/api/user/profile', 'profile_update', {\r\n      fields_updated: Object.keys(updateData)\r\n    })\r\n    \r\n    return ApiResponse.success(\r\n      { profile: updatedProfile },\r\n      'Profile updated successfully'\r\n    )\r\n    \r\n  } catch (error) {\r\n    console.error('Profile update handler error:', error)\r\n    return ApiResponse.internalError('Failed to process profile update')\r\n  }\r\n}\r\n\r\n// DELETE /api/user/profile - Delete user account\r\nasync function deleteProfileHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const supabase = supabaseAdmin\r\n    \r\n    // Start transaction-like operations\r\n    // 1. Delete user data from related tables\r\n    await Promise.all([\r\n      supabase.from('conversations').delete().eq('user_id', user.id),\r\n      supabase.from('file_metadata').delete().eq('user_id', user.id),\r\n      supabase.from('document_chunks').delete().eq('user_id', user.id),\r\n      supabase.from('usage_logs').delete().eq('user_id', user.id),\r\n      supabase.from('oauth_tokens').delete().eq('user_id', user.id),\r\n      supabase.from('user_settings').delete().eq('user_id', user.id),\r\n    ])\r\n    \r\n    // 2. Delete user profile\r\n    const { error: deleteError } = await supabase\r\n      .from('users')\r\n      .delete()\r\n      .eq('id', user.id)\r\n    \r\n    if (deleteError) {\r\n      console.error('Profile deletion error:', deleteError)\r\n      return ApiResponse.internalError('Failed to delete profile')\r\n    }\r\n    \r\n    // 3. Delete from Supabase Auth\r\n    const { error: authDeleteError } = await supabase.auth.admin.deleteUser(user.id)\r\n    \r\n    if (authDeleteError) {\r\n      console.error('Auth deletion error:', authDeleteError)\r\n      // Continue anyway as the profile data is already deleted\r\n    }\r\n    \r\n    // Log usage\r\n    logApiUsage(user.id, '/api/user/profile', 'account_deletion')\r\n    \r\n    return ApiResponse.success(\r\n      null,\r\n      'Account deleted successfully'\r\n    )\r\n    \r\n  } catch (error) {\r\n    console.error('Profile deletion handler error:', error)\r\n    return ApiResponse.internalError('Failed to process account deletion')\r\n  }\r\n}\r\n\r\n// Export handlers with middleware\r\nexport const GET = createProtectedApiHandler(getProfileHandler, {\r\n  rateLimit: rateLimitConfigs.general,\r\n  logging: {\r\n    enabled: true,\r\n    includeBody: false,\r\n  },\r\n})\r\n\r\nexport const PUT = createProtectedApiHandler(updateProfileHandler, {\r\n  rateLimit: {\r\n    ...rateLimitConfigs.general,\r\n    maxRequests: 20, // More restrictive for updates\r\n  },\r\n  validation: {\r\n    body: userProfileSchema,\r\n  },\r\n  logging: {\r\n    enabled: true,\r\n    includeBody: true,\r\n  },\r\n})\r\n\r\nexport const DELETE = createProtectedApiHandler(deleteProfileHandler, {\r\n  rateLimit: {\r\n    ...rateLimitConfigs.strict,\r\n    maxRequests: 2, // Very restrictive for account deletion\r\n  },\r\n  logging: {\r\n    enabled: true,\r\n    includeBody: false,\r\n  },\r\n})"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}