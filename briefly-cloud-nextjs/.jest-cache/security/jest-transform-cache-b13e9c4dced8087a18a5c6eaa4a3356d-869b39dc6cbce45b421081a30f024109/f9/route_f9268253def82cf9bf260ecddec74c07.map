{"version":3,"names":["DELETE","cov_10bzcew6ke","f","s","GET","PUT","getFileHandler","request","context","user","b","_apiutils","ApiResponse","unauthorized","url","URL","fileId","pathname","split","pop","badRequest","supabase","_supabase","supabaseAdmin","data","file","error","from","select","eq","id","single","notFound","processingInfo","processed","jobs","contains","file_ids","order","ascending","limit","length","job_id","status","progress","output_data","message","_logger","logApiUsage","file_id","file_name","name","success","size","mime_type","source","processing_status","external_url","created_at","updated_at","metadata","processing_info","console","internalError","deleteFileHandler","fetchError","path","storageError","storage","remove","chunksError","delete","deleteError","userProfile","update","documents_uploaded","Math","max","storage_used_bytes","Date","toISOString","file_size","updateFileHandler","body","json","existingFile","updateData","updatedFile","updateError","updated_fields","Object","keys","_apimiddleware","createProtectedApiHandler","rateLimit","_ratelimit","rateLimitConfigs","general","logging","enabled","includeBody","maxRequests"],"sources":["R:\\Apps\\Briefly_Cloud\\briefly-cloud-nextjs\\src\\app\\api\\upload\\files\\[fileId]\\route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createProtectedApiHandler, ApiContext } from '@/app/lib/api-middleware'\r\nimport { ApiResponse } from '@/app/lib/api-utils'\r\nimport { rateLimitConfigs } from '@/app/lib/rate-limit'\r\nimport { supabaseAdmin } from '@/app/lib/supabase'\r\nimport { logApiUsage } from '@/app/lib/logger'\r\n\r\n// GET /api/upload/files/[fileId] - Get specific file details\r\nasync function getFileHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const url = new URL(request.url)\r\n    const fileId = url.pathname.split('/').pop()\r\n    \r\n    if (!fileId) {\r\n      return ApiResponse.badRequest('File ID is required')\r\n    }\r\n    \r\n    const supabase = supabaseAdmin\r\n    \r\n    // Get file metadata\r\n    const { data: file, error } = await supabase\r\n      .from('file_metadata')\r\n      .select('*')\r\n      .eq('id', fileId)\r\n      .eq('user_id', user.id) // Ensure user owns the file\r\n      .single()\r\n    \r\n    if (error || !file) {\r\n      return ApiResponse.notFound('File')\r\n    }\r\n    \r\n    // Get processing status if available\r\n    let processingInfo = null\r\n    if (!file.processed) {\r\n      // Check for any processing jobs\r\n      const { data: jobs } = await supabase\r\n        .from('job_logs')\r\n        .select('*')\r\n        .eq('user_id', user.id)\r\n        .contains('input_data', { file_ids: [fileId] })\r\n        .order('created_at', { ascending: false })\r\n        .limit(1)\r\n      \r\n      if (jobs && jobs.length > 0) {\r\n        processingInfo = {\r\n          job_id: jobs[0].id,\r\n          status: jobs[0].status,\r\n          progress: jobs[0].output_data?.progress || 0,\r\n          message: jobs[0].output_data?.message || '',\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Log usage\r\n    logApiUsage(user.id, '/api/upload/files/[fileId]', 'file_view', {\r\n      file_id: fileId,\r\n      file_name: file.name,\r\n    })\r\n    \r\n    return ApiResponse.success({\r\n      file: {\r\n        id: file.id,\r\n        name: file.name,\r\n        size: file.size,\r\n        mime_type: file.mime_type,\r\n        source: file.source,\r\n        processed: file.processed,\r\n        processing_status: file.processing_status,\r\n        external_url: file.external_url,\r\n        created_at: file.created_at,\r\n        updated_at: file.updated_at,\r\n        metadata: file.metadata,\r\n        processing_info: processingInfo,\r\n      },\r\n    })\r\n    \r\n  } catch (error) {\r\n    console.error('Get file handler error:', error)\r\n    return ApiResponse.internalError('Failed to get file details')\r\n  }\r\n}\r\n\r\n// DELETE /api/upload/files/[fileId] - Delete specific file\r\nasync function deleteFileHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const url = new URL(request.url)\r\n    const fileId = url.pathname.split('/').pop()\r\n    \r\n    if (!fileId) {\r\n      return ApiResponse.badRequest('File ID is required')\r\n    }\r\n    \r\n    const supabase = supabaseAdmin\r\n    \r\n    // Get file metadata first\r\n    const { data: file, error: fetchError } = await supabase\r\n      .from('file_metadata')\r\n      .select('*')\r\n      .eq('id', fileId)\r\n      .eq('user_id', user.id) // Ensure user owns the file\r\n      .single()\r\n    \r\n    if (fetchError || !file) {\r\n      return ApiResponse.notFound('File')\r\n    }\r\n    \r\n    // Delete from storage if it's an uploaded file\r\n    if (file.source === 'upload' && file.path) {\r\n      const { error: storageError } = await supabase.storage\r\n        .from('documents')\r\n        .remove([file.path])\r\n      \r\n      if (storageError) {\r\n        console.error('Storage deletion error:', storageError)\r\n        // Continue with metadata deletion even if storage deletion fails\r\n      }\r\n    }\r\n    \r\n    // Delete related document chunks\r\n    const { error: chunksError } = await supabase\r\n      .from('document_chunks')\r\n      .delete()\r\n      .eq('file_id', fileId)\r\n    \r\n    if (chunksError) {\r\n      console.error('Chunks deletion error:', chunksError)\r\n      // Continue with file deletion\r\n    }\r\n    \r\n    // Delete file metadata\r\n    const { error: deleteError } = await supabase\r\n      .from('file_metadata')\r\n      .delete()\r\n      .eq('id', fileId)\r\n      .eq('user_id', user.id)\r\n    \r\n    if (deleteError) {\r\n      console.error('File metadata deletion error:', deleteError)\r\n      return ApiResponse.internalError('Failed to delete file')\r\n    }\r\n    \r\n    // Update user usage statistics\r\n    const { data: userProfile } = await supabase\r\n      .from('users')\r\n      .select('documents_uploaded, storage_used_bytes')\r\n      .eq('id', user.id)\r\n      .single()\r\n    \r\n    if (userProfile) {\r\n      await supabase\r\n        .from('users')\r\n        .update({\r\n          documents_uploaded: Math.max(0, (userProfile.documents_uploaded || 0) - 1),\r\n          storage_used_bytes: Math.max(0, (userProfile.storage_used_bytes || 0) - file.size),\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', user.id)\r\n    }\r\n    \r\n    // Log usage\r\n    logApiUsage(user.id, '/api/upload/files/[fileId]', 'file_delete', {\r\n      file_id: fileId,\r\n      file_name: file.name,\r\n      file_size: file.size,\r\n    })\r\n    \r\n    return ApiResponse.success(\r\n      null,\r\n      'File deleted successfully'\r\n    )\r\n    \r\n  } catch (error) {\r\n    console.error('Delete file handler error:', error)\r\n    return ApiResponse.internalError('Failed to delete file')\r\n  }\r\n}\r\n\r\n// PUT /api/upload/files/[fileId] - Update file metadata\r\nasync function updateFileHandler(request: Request, context: ApiContext): Promise<NextResponse> {\r\n  const { user } = context\r\n  \r\n  if (!user) {\r\n    return ApiResponse.unauthorized('User not authenticated')\r\n  }\r\n  \r\n  try {\r\n    const url = new URL(request.url)\r\n    const fileId = url.pathname.split('/').pop()\r\n    \r\n    if (!fileId) {\r\n      return ApiResponse.badRequest('File ID is required')\r\n    }\r\n    \r\n    const body = await request.json()\r\n    const { name, metadata } = body\r\n    \r\n    if (!name && !metadata) {\r\n      return ApiResponse.badRequest('Name or metadata is required for update')\r\n    }\r\n    \r\n    const supabase = supabaseAdmin\r\n    \r\n    // Check if file exists and user owns it\r\n    const { data: existingFile, error: fetchError } = await supabase\r\n      .from('file_metadata')\r\n      .select('*')\r\n      .eq('id', fileId)\r\n      .eq('user_id', user.id)\r\n      .single()\r\n    \r\n    if (fetchError || !existingFile) {\r\n      return ApiResponse.notFound('File')\r\n    }\r\n    \r\n    // Prepare update data\r\n    const updateData: any = {\r\n      updated_at: new Date().toISOString(),\r\n    }\r\n    \r\n    if (name) {\r\n      updateData.name = name\r\n    }\r\n    \r\n    if (metadata) {\r\n      updateData.metadata = {\r\n        ...existingFile.metadata,\r\n        ...metadata,\r\n      }\r\n    }\r\n    \r\n    // Update file metadata\r\n    const { data: updatedFile, error: updateError } = await supabase\r\n      .from('file_metadata')\r\n      .update(updateData)\r\n      .eq('id', fileId)\r\n      .eq('user_id', user.id)\r\n      .select()\r\n      .single()\r\n    \r\n    if (updateError) {\r\n      console.error('File update error:', updateError)\r\n      return ApiResponse.internalError('Failed to update file')\r\n    }\r\n    \r\n    // Log usage\r\n    logApiUsage(user.id, '/api/upload/files/[fileId]', 'file_update', {\r\n      file_id: fileId,\r\n      file_name: updatedFile.name,\r\n      updated_fields: Object.keys(updateData),\r\n    })\r\n    \r\n    return ApiResponse.success({\r\n      file: {\r\n        id: updatedFile.id,\r\n        name: updatedFile.name,\r\n        size: updatedFile.size,\r\n        mime_type: updatedFile.mime_type,\r\n        source: updatedFile.source,\r\n        processed: updatedFile.processed,\r\n        processing_status: updatedFile.processing_status,\r\n        external_url: updatedFile.external_url,\r\n        created_at: updatedFile.created_at,\r\n        updated_at: updatedFile.updated_at,\r\n        metadata: updatedFile.metadata,\r\n      },\r\n    }, 'File updated successfully')\r\n    \r\n  } catch (error) {\r\n    console.error('Update file handler error:', error)\r\n    return ApiResponse.internalError('Failed to update file')\r\n  }\r\n}\r\n\r\n// Export handlers with middleware\r\nexport const GET = createProtectedApiHandler(getFileHandler, {\r\n  rateLimit: rateLimitConfigs.general,\r\n  logging: {\r\n    enabled: true,\r\n    includeBody: false,\r\n  },\r\n})\r\n\r\nexport const DELETE = createProtectedApiHandler(deleteFileHandler, {\r\n  rateLimit: {\r\n    ...rateLimitConfigs.general,\r\n    maxRequests: 50, // More restrictive for deletions\r\n  },\r\n  logging: {\r\n    enabled: true,\r\n    includeBody: false,\r\n  },\r\n})\r\n\r\nexport const PUT = createProtectedApiHandler(updateFileHandler, {\r\n  rateLimit: rateLimitConfigs.general,\r\n  logging: {\r\n    enabled: true,\r\n    includeBody: true,\r\n  },\r\n})"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}