/**\n * Usage Dashboard Component\n * \n * This component displays comprehensive usage analytics, limits,\n * and recommendations for the authenticated user.\n */\n\n'use client'\n\nimport React, { useState, useEffect } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/app/components/ui/card'\nimport { Progress } from '@/app/components/ui/progress'\nimport { Badge } from '@/app/components/ui/badge'\nimport { Button } from '@/app/components/ui/button'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/app/components/ui/tabs'\nimport { Alert, AlertDescription, AlertTitle } from '@/app/components/ui/alert'\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  LineChart,\n  Line,\n  PieChart,\n  Pie,\n  Cell\n} from 'recharts'\nimport { \n  MessageSquare, \n  Upload, \n  Search, \n  Database, \n  TrendingUp, \n  TrendingDown,\n  AlertTriangle,\n  CheckCircle,\n  Clock,\n  Zap\n} from 'lucide-react'\n\ninterface UsageData {\n  subscription: {\n    tier: string\n    status: string\n    limits: {\n      chatMessages: { current: number; limit: number; remaining: number; percentUsed: number }\n      documents: { current: number; limit: number; remaining: number; percentUsed: number }\n      apiCalls: { current: number; limit: number; remaining: number; percentUsed: number }\n      storage: { current: number; limit: number; remaining: number; percentUsed: number }\n    }\n  }\n  trends: {\n    chatMessages: { current: number; previous: number; change: number; percentChange: number }\n    uploads: { current: number; previous: number; change: number; percentChange: number }\n    apiCalls: { current: number; previous: number; change: number; percentChange: number }\n  }\n  efficiency: {\n    averageSessionLength: number\n    documentsPerSession: number\n    queriesPerDocument: number\n    successRate: number\n  }\n  recommendations: Array<{\n    reason: string\n    recommendedTier: string\n    benefits: string[]\n  }>\n  recentActivity: Array<{\n    action: string\n    timestamp: string\n    quantity: number\n  }>\n  insights: {\n    mostUsedFeature: string\n    peakUsageDay: string\n    averageDailyUsage: number\n    projectedMonthlyUsage: number\n  }\n}\n\nconst COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8']\n\nexport function UsageDashboard() {\n  const [usageData, setUsageData] = useState<UsageData | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [selectedPeriod, setSelectedPeriod] = useState('current')\n\n  useEffect(() => {\n    fetchUsageData()\n  }, [selectedPeriod])\n\n  const fetchUsageData = async () => {\n    try {\n      setLoading(true)\n      const response = await fetch(`/api/usage/analytics?period=${selectedPeriod}`)\n      const result = await response.json()\n      \n      if (!result.success) {\n        throw new Error(result.message || 'Failed to fetch usage data')\n      }\n      \n      setUsageData(result.data)\n      setError(null)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const formatBytes = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes'\n    const k = 1024\n    const sizes = ['Bytes', 'KB', 'MB', 'GB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\n  }\n\n  const getTierColor = (tier: string) => {\n    switch (tier) {\n      case 'free': return 'bg-gray-100 text-gray-800'\n      case 'pro': return 'bg-blue-100 text-blue-800'\n      case 'pro_byok': return 'bg-purple-100 text-purple-800'\n      default: return 'bg-gray-100 text-gray-800'\n    }\n  }\n\n  const getUsageColor = (percentUsed: number) => {\n    if (percentUsed >= 90) return 'text-red-600'\n    if (percentUsed >= 75) return 'text-yellow-600'\n    return 'text-green-600'\n  }\n\n  const getTrendIcon = (change: number) => {\n    if (change > 0) return <TrendingUp className=\"h-4 w-4 text-green-600\" />\n    if (change < 0) return <TrendingDown className=\"h-4 w-4 text-red-600\" />\n    return <div className=\"h-4 w-4\" />\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n        <span className=\"ml-2\">Loading usage data...</span>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <Alert variant=\"destructive\">\n        <AlertTriangle className=\"h-4 w-4\" />\n        <AlertTitle>Error</AlertTitle>\n        <AlertDescription>{error}</AlertDescription>\n        <Button onClick={fetchUsageData} className=\"mt-2\">Retry</Button>\n      </Alert>\n    )\n  }\n\n  if (!usageData) {\n    return <div>No usage data available</div>\n  }\n\n  const chartData = [\n    { name: 'Chat', current: usageData.trends.chatMessages.current, previous: usageData.trends.chatMessages.previous },\n    { name: 'Uploads', current: usageData.trends.uploads.current, previous: usageData.trends.uploads.previous },\n    { name: 'API Calls', current: usageData.trends.apiCalls.current, previous: usageData.trends.apiCalls.previous }\n  ]\n\n  const pieData = [\n    { name: 'Chat Messages', value: usageData.trends.chatMessages.current },\n    { name: 'Document Uploads', value: usageData.trends.uploads.current },\n    { name: 'API Calls', value: usageData.trends.apiCalls.current }\n  ].filter(item => item.value > 0)\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Usage Dashboard</h1>\n          <p className=\"text-gray-600\">Monitor your usage, limits, and performance</p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Badge className={getTierColor(usageData.subscription.tier)}>\n            {usageData.subscription.tier.toUpperCase()} Plan\n          </Badge>\n          <select \n            value={selectedPeriod} \n            onChange={(e) => setSelectedPeriod(e.target.value)}\n            className=\"px-3 py-1 border rounded-md\"\n          >\n            <option value=\"current\">Current Period</option>\n            <option value=\"previous\">Previous Period</option>\n          </select>\n        </div>\n      </div>\n\n      {/* Recommendations Alert */}\n      {usageData.recommendations.length > 0 && (\n        <Alert>\n          <Zap className=\"h-4 w-4\" />\n          <AlertTitle>Upgrade Recommendations</AlertTitle>\n          <AlertDescription>\n            {usageData.recommendations[0].reason}. Consider upgrading to {usageData.recommendations[0].recommendedTier} for better limits.\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Usage Limits Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Chat Messages</CardTitle>\n            <MessageSquare className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {usageData.subscription.limits.chatMessages.current}\n              <span className=\"text-sm text-gray-500\">/{usageData.subscription.limits.chatMessages.limit === Infinity ? '∞' : usageData.subscription.limits.chatMessages.limit}</span>\n            </div>\n            <Progress \n              value={usageData.subscription.limits.chatMessages.percentUsed} \n              className=\"mt-2\" \n            />\n            <p className={`text-xs mt-1 ${getUsageColor(usageData.subscription.limits.chatMessages.percentUsed)}`}>\n              {usageData.subscription.limits.chatMessages.percentUsed.toFixed(1)}% used\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Documents</CardTitle>\n            <Upload className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {usageData.subscription.limits.documents.current}\n              <span className=\"text-sm text-gray-500\">/{usageData.subscription.limits.documents.limit === Infinity ? '∞' : usageData.subscription.limits.documents.limit}</span>\n            </div>\n            <Progress \n              value={usageData.subscription.limits.documents.percentUsed} \n              className=\"mt-2\" \n            />\n            <p className={`text-xs mt-1 ${getUsageColor(usageData.subscription.limits.documents.percentUsed)}`}>\n              {usageData.subscription.limits.documents.percentUsed.toFixed(1)}% used\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">API Calls</CardTitle>\n            <Search className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {usageData.subscription.limits.apiCalls.current}\n              <span className=\"text-sm text-gray-500\">/{usageData.subscription.limits.apiCalls.limit === Infinity ? '∞' : usageData.subscription.limits.apiCalls.limit}</span>\n            </div>\n            <Progress \n              value={usageData.subscription.limits.apiCalls.percentUsed} \n              className=\"mt-2\" \n            />\n            <p className={`text-xs mt-1 ${getUsageColor(usageData.subscription.limits.apiCalls.percentUsed)}`}>\n              {usageData.subscription.limits.apiCalls.percentUsed.toFixed(1)}% used\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Storage</CardTitle>\n            <Database className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatBytes(usageData.subscription.limits.storage.current)}\n            </div>\n            <Progress \n              value={usageData.subscription.limits.storage.percentUsed} \n              className=\"mt-2\" \n            />\n            <p className={`text-xs mt-1 ${getUsageColor(usageData.subscription.limits.storage.percentUsed)}`}>\n              {usageData.subscription.limits.storage.percentUsed.toFixed(1)}% used\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Trends and Analytics */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Usage Trends</CardTitle>\n            <CardDescription>Compare current vs previous period</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart data={chartData}>\n                <CartesianGrid strokeDasharray=\"3 3\" />\n                <XAxis dataKey=\"name\" />\n                <YAxis />\n                <Tooltip />\n                <Bar dataKey=\"previous\" fill=\"#e5e7eb\" name=\"Previous\" />\n                <Bar dataKey=\"current\" fill=\"#3b82f6\" name=\"Current\" />\n              </BarChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Usage Distribution</CardTitle>\n            <CardDescription>Current period breakdown</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <PieChart>\n                <Pie\n                  data={pieData}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  outerRadius={80}\n                  fill=\"#8884d8\"\n                  dataKey=\"value\"\n                  label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                >\n                  {pieData.map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                  ))}\n                </Pie>\n                <Tooltip />\n              </PieChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Detailed Analytics */}\n      <Tabs defaultValue=\"insights\" className=\"w-full\">\n        <TabsList>\n          <TabsTrigger value=\"insights\">Insights</TabsTrigger>\n          <TabsTrigger value=\"efficiency\">Efficiency</TabsTrigger>\n          <TabsTrigger value=\"activity\">Recent Activity</TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"insights\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Most Used Feature</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-bold capitalize\">{usageData.insights.mostUsedFeature}</p>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Peak Usage Day</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-bold\">{usageData.insights.peakUsageDay}</p>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Daily Average</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-bold\">{usageData.insights.averageDailyUsage}</p>\n                <p className=\"text-xs text-gray-500\">actions per day</p>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Monthly Projection</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-bold\">{usageData.insights.projectedMonthlyUsage}</p>\n                <p className=\"text-xs text-gray-500\">total actions</p>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n        \n        <TabsContent value=\"efficiency\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Avg Session Length</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-bold\">{usageData.efficiency.averageSessionLength.toFixed(1)}</p>\n                <p className=\"text-xs text-gray-500\">minutes</p>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Docs per Session</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-bold\">{usageData.efficiency.documentsPerSession.toFixed(1)}</p>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Queries per Doc</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-bold\">{usageData.efficiency.queriesPerDocument.toFixed(1)}</p>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm\">Success Rate</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-2xl font-bold\">{usageData.efficiency.successRate.toFixed(1)}%</p>\n                <div className=\"flex items-center mt-1\">\n                  <CheckCircle className=\"h-3 w-3 text-green-600 mr-1\" />\n                  <span className=\"text-xs text-green-600\">Excellent</span>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n        \n        <TabsContent value=\"activity\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Recent Activity</CardTitle>\n              <CardDescription>Your latest actions and usage</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {usageData.recentActivity.slice(0, 10).map((activity, index) => (\n                  <div key={index} className=\"flex items-center justify-between py-2 border-b last:border-b-0\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-2 h-2 bg-blue-600 rounded-full\"></div>\n                      <span className=\"capitalize\">{activity.action.replace('_', ' ')}</span>\n                      {activity.quantity > 1 && (\n                        <Badge variant=\"secondary\">×{activity.quantity}</Badge>\n                      )}\n                    </div>\n                    <div className=\"flex items-center text-sm text-gray-500\">\n                      <Clock className=\"h-3 w-3 mr-1\" />\n                      {new Date(activity.timestamp).toLocaleString()}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  )\n}